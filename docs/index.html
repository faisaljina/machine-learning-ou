---
layout: default
---


<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --></head>

 <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css"> -->

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://rawgit.com/ipython-contrib/jupyter_contrib_nbextensions/master/src/jupyter_contrib_nbextensions/nbextensions/toc2/main.css">

<!-- <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->

<script src="https://rawgit.com/ipython-contrib/jupyter_contrib_nbextensions/master/src/jupyter_contrib_nbextensions/nbextensions/toc2/toc2.js"></script>

<script>
$( document ).ready(function(){

            var cfg = {};

            // fire the main function with these parameters
            require(['nbextensions/toc2/toc2'], function (toc2) {
                toc2.table_of_contents(cfg);
            });
    });
</script>
<body>
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Introduction">Introduction<a class="anchor-link" href="#Introduction">&#182;</a></h1><p>The Open University operate a mostly distance-based education platform, supported by a Virtual Learning Environment (VLE) to assist students with their courses. They have provided several datasets and a corresponding schematic with the aim of predicting which students on their courses will withdraw or fail their course.
Initially, the datasets will be examined for content, with the goal of merging all of the relevant data into a single dataset. This will involve deciding on which features to retain, to engineer into new columns, or to drop from the dataset. As both classification and regression are required, a target variable for withdrawn students will be used for classification, and a score-based variable will be used for regression. As failures are decided by the coursework and exam score (excluding extenuating circumstances), this score variable will be used as a proxy for examining failures.
Naturally, the extent of exloratory data analysis (EDA) actually executed vastly exceeds what is interesting, so some has been trimmed from this document for the sake of brevity.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Importing-and-Merging-Data">Importing and Merging Data<a class="anchor-link" href="#Importing-and-Merging-Data">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Import standard packages, and set seaborn styling</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Student-VLE-data">Student VLE data<a class="anchor-link" href="#Student-VLE-data">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">svle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;studentVle.csv&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">svle</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>id_site</th>
      <th>date</th>
      <th>sum_click</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>28400</td>
      <td>546652</td>
      <td>-10</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>28400</td>
      <td>546652</td>
      <td>-10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>28400</td>
      <td>546652</td>
      <td>-10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>28400</td>
      <td>546614</td>
      <td>-10</td>
      <td>11</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>28400</td>
      <td>546714</td>
      <td>-10</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">svle</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 10655280 entries, 0 to 10655279
Data columns (total 6 columns):
 #   Column             Dtype 
---  ------             ----- 
 0   code_module        object
 1   code_presentation  object
 2   id_student         int64 
 3   id_site            int64 
 4   date               int64 
 5   sum_click          int64 
dtypes: int64(4), object(2)
memory usage: 487.8+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">svle</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_student</th>
      <th>id_site</th>
      <th>date</th>
      <th>sum_click</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1.065528e+07</td>
      <td>1.065528e+07</td>
      <td>1.065528e+07</td>
      <td>1.065528e+07</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>7.333336e+05</td>
      <td>7.383234e+05</td>
      <td>9.517400e+01</td>
      <td>3.716946e+00</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5.827060e+05</td>
      <td>1.312196e+05</td>
      <td>7.607130e+01</td>
      <td>8.849047e+00</td>
    </tr>
    <tr>
      <th>min</th>
      <td>6.516000e+03</td>
      <td>5.267210e+05</td>
      <td>-2.500000e+01</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>5.077430e+05</td>
      <td>6.735190e+05</td>
      <td>2.500000e+01</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>5.882360e+05</td>
      <td>7.300690e+05</td>
      <td>8.600000e+01</td>
      <td>2.000000e+00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>6.464840e+05</td>
      <td>8.770300e+05</td>
      <td>1.560000e+02</td>
      <td>3.000000e+00</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.698588e+06</td>
      <td>1.049562e+06</td>
      <td>2.690000e+02</td>
      <td>6.977000e+03</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Having investigated the date column for empty rows and found none, the distribution of clicks by date is examined.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Check date is not empty - not evident from describe due to size of dataset (output not shown)</span>
<span class="c1"># svle[np.isnan(svle[&#39;date&#39;])]</span>

<span class="c1"># Import package to plot the graph</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">svle</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="n">svle</span><span class="p">[</span><span class="s1">&#39;sum_click&#39;</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sum of Clicks&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram showing the distribution of clicks by date&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="output_9_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We know there are no empty date rows, and this distribution is fairly level apart from the initial spike once a course starts. It is therefore not immediately obvious how to split this data. However, from a behavioural perspective, it would make sense to split this into two categories of vle before/after the module start date - this makes 2 separate measures of how keen a student is to access learning materials both before and after starting a module.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The new columns are created</span>
<span class="n">svle</span><span class="p">[</span><span class="s1">&#39;vle_before&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">svle</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">svle</span><span class="p">[</span><span class="s1">&#39;sum_click&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
<span class="n">svle</span><span class="p">[</span><span class="s1">&#39;vle_after&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">svle</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span><span class="n">svle</span><span class="p">[</span><span class="s1">&#39;sum_click&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># The other columns are removed</span>
<span class="n">svle</span> <span class="o">=</span> <span class="n">svle</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;sum_click&#39;</span><span class="p">,</span><span class="s1">&#39;id_site&#39;</span><span class="p">])</span>
<span class="c1"># The remaining columns are grouped by student, module, and presentation</span>
<span class="n">svle</span> <span class="o">=</span> <span class="n">svle</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;id_student&#39;</span><span class="p">,</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;code_module&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># Show the new structure</span>
<span class="n">svle</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>vle_before</th>
      <th>vle_after</th>
    </tr>
    <tr>
      <th>id_student</th>
      <th>code_presentation</th>
      <th>code_module</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6516</th>
      <th>2014J</th>
      <th>AAA</th>
      <td>256</td>
      <td>2535</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">8462</th>
      <th>2013J</th>
      <th>DDD</th>
      <td>81</td>
      <td>565</td>
    </tr>
    <tr>
      <th>2014J</th>
      <th>DDD</th>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>11391</th>
      <th>2013J</th>
      <th>AAA</th>
      <td>98</td>
      <td>836</td>
    </tr>
    <tr>
      <th>23629</th>
      <th>2013B</th>
      <th>BBB</th>
      <td>14</td>
      <td>147</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">svle</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
MultiIndex: 29228 entries, (6516, &#39;2014J&#39;, &#39;AAA&#39;) to (2698588, &#39;2014J&#39;, &#39;BBB&#39;)
Data columns (total 2 columns):
 #   Column      Non-Null Count  Dtype
---  ------      --------------  -----
 0   vle_before  29228 non-null  int64
 1   vle_after   29228 non-null  int64
dtypes: int64(2)
memory usage: 774.8+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Student-Information-data">Student Information data<a class="anchor-link" href="#Student-Information-data">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The student info dataset is read in</span>
<span class="n">sinfo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;studentInfo.csv&quot;</span><span class="p">)</span>
<span class="n">sinfo</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 32593 entries, 0 to 32592
Data columns (total 12 columns):
 #   Column                Non-Null Count  Dtype 
---  ------                --------------  ----- 
 0   code_module           32593 non-null  object
 1   code_presentation     32593 non-null  object
 2   id_student            32593 non-null  int64 
 3   gender                32593 non-null  object
 4   region                32593 non-null  object
 5   highest_education     32593 non-null  object
 6   imd_band              31482 non-null  object
 7   age_band              32593 non-null  object
 8   num_of_prev_attempts  32593 non-null  int64 
 9   studied_credits       32593 non-null  int64 
 10  disability            32593 non-null  object
 11  final_result          32593 non-null  object
dtypes: int64(3), object(9)
memory usage: 3.0+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sinfo</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[10]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>gender</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>M</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>N</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>28400</td>
      <td>F</td>
      <td>Scotland</td>
      <td>HE Qualification</td>
      <td>20-30%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>N</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>30268</td>
      <td>F</td>
      <td>North Western Region</td>
      <td>A Level or Equivalent</td>
      <td>30-40%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>Y</td>
      <td>Withdrawn</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>31604</td>
      <td>F</td>
      <td>South East Region</td>
      <td>A Level or Equivalent</td>
      <td>50-60%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>N</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>32885</td>
      <td>F</td>
      <td>West Midlands Region</td>
      <td>Lower Than A Level</td>
      <td>50-60%</td>
      <td>0-35</td>
      <td>0</td>
      <td>60</td>
      <td>N</td>
      <td>Pass</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Check the values for gender and disability</span>
<span class="n">sinfo</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array([&#39;M&#39;, &#39;F&#39;], dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sinfo</span><span class="p">[</span><span class="s1">&#39;disability&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array([&#39;N&#39;, &#39;Y&#39;], dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># One-hot encode these variables - these need to be numeric to run the models</span>
<span class="n">sinfo</span><span class="p">[</span><span class="s1">&#39;gender_F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sinfo</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sinfo</span><span class="p">[</span><span class="s1">&#39;disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sinfo</span><span class="p">[</span><span class="s1">&#39;disability&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sinfo</span> <span class="o">=</span> <span class="n">sinfo</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;gender&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Check spread of missing values of imd_band across target groups</span>
<span class="n">sinfo</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;final_result&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[14]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>gender_F</th>
    </tr>
    <tr>
      <th>final_result</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Distinction</th>
      <td>3024</td>
      <td>3024</td>
      <td>3024</td>
      <td>3024</td>
      <td>3024</td>
      <td>2825</td>
      <td>3024</td>
      <td>3024</td>
      <td>3024</td>
      <td>3024</td>
      <td>3024</td>
    </tr>
    <tr>
      <th>Fail</th>
      <td>7052</td>
      <td>7052</td>
      <td>7052</td>
      <td>7052</td>
      <td>7052</td>
      <td>6907</td>
      <td>7052</td>
      <td>7052</td>
      <td>7052</td>
      <td>7052</td>
      <td>7052</td>
    </tr>
    <tr>
      <th>Pass</th>
      <td>12361</td>
      <td>12361</td>
      <td>12361</td>
      <td>12361</td>
      <td>12361</td>
      <td>11830</td>
      <td>12361</td>
      <td>12361</td>
      <td>12361</td>
      <td>12361</td>
      <td>12361</td>
    </tr>
    <tr>
      <th>Withdrawn</th>
      <td>10156</td>
      <td>10156</td>
      <td>10156</td>
      <td>10156</td>
      <td>10156</td>
      <td>9920</td>
      <td>10156</td>
      <td>10156</td>
      <td>10156</td>
      <td>10156</td>
      <td>10156</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Imd_band has missing values, but these do not appear to be informative across the 'final_result' classes. These can be imputed later and should not unduly influence the models.
To help with keeping track of the dataset operations, an arbitrary student is selected to follow through this process.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sinfo</span><span class="p">[</span><span class="n">sinfo</span><span class="p">[</span><span class="s1">&#39;id_student&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8462</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[15]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14395</th>
      <td>DDD</td>
      <td>2013J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>90</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
    </tr>
    <tr>
      <th>17560</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>1</td>
      <td>60</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The datasets are merged into a new one, sdf</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sinfo</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">svle</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id_student&#39;</span><span class="p">,</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;code_module&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;id_student&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8462</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[17]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14395</th>
      <td>DDD</td>
      <td>2013J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>90</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>81.0</td>
      <td>565.0</td>
    </tr>
    <tr>
      <th>17560</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>1</td>
      <td>60</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>0.0</td>
      <td>10.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdf</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 32593 entries, 0 to 32592
Data columns (total 14 columns):
 #   Column                Non-Null Count  Dtype  
---  ------                --------------  -----  
 0   code_module           32593 non-null  object 
 1   code_presentation     32593 non-null  object 
 2   id_student            32593 non-null  int64  
 3   region                32593 non-null  object 
 4   highest_education     32593 non-null  object 
 5   imd_band              31482 non-null  object 
 6   age_band              32593 non-null  object 
 7   num_of_prev_attempts  32593 non-null  int64  
 8   studied_credits       32593 non-null  int64  
 9   disability            32593 non-null  int32  
 10  final_result          32593 non-null  object 
 11  gender_F              32593 non-null  int32  
 12  vle_before            29228 non-null  float64
 13  vle_after             29228 non-null  float64
dtypes: float64(2), int32(2), int64(3), object(7)
memory usage: 3.5+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We notice here that student VLE data has absent rows, despite matching all of it with the student info dataset. This may suggest that those students had no interaction with the VLE at all, or it could suggest missing data - this will be discussed later.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The two merged datasets are deleted for the sake of memory usage</span>
<span class="k">del</span> <span class="n">sinfo</span>
<span class="k">del</span> <span class="n">svle</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Student-Registration-data">Student Registration data<a class="anchor-link" href="#Student-Registration-data">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The student registration data is read in</span>
<span class="n">sreg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;studentRegistration.csv&quot;</span><span class="p">)</span>
<span class="n">sreg</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 32593 entries, 0 to 32592
Data columns (total 5 columns):
 #   Column               Non-Null Count  Dtype  
---  ------               --------------  -----  
 0   code_module          32593 non-null  object 
 1   code_presentation    32593 non-null  object 
 2   id_student           32593 non-null  int64  
 3   date_registration    32548 non-null  float64
 4   date_unregistration  10072 non-null  float64
dtypes: float64(2), int64(1), object(2)
memory usage: 1.2+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We immediately notice that the date_registration has missing data - this makes no sense, as there would not be a record without a registration date. This data will need imputing later.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sreg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[21]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>date_registration</th>
      <th>date_unregistration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>-159.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>28400</td>
      <td>-53.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>30268</td>
      <td>-92.0</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>31604</td>
      <td>-52.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>32885</td>
      <td>-176.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sreg</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[22]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_student</th>
      <th>date_registration</th>
      <th>date_unregistration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3.259300e+04</td>
      <td>32548.000000</td>
      <td>10072.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>7.066877e+05</td>
      <td>-69.411300</td>
      <td>49.757645</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5.491673e+05</td>
      <td>49.260522</td>
      <td>82.460890</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.733000e+03</td>
      <td>-322.000000</td>
      <td>-365.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>5.085730e+05</td>
      <td>-100.000000</td>
      <td>-2.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>5.903100e+05</td>
      <td>-57.000000</td>
      <td>27.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>6.444530e+05</td>
      <td>-29.000000</td>
      <td>109.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.716795e+06</td>
      <td>167.000000</td>
      <td>444.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a very simple dataset - no further investigation is needed before merging this.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The student record is again picked out</span>
<span class="n">sreg</span><span class="p">[</span><span class="n">sreg</span><span class="p">[</span><span class="s1">&#39;id_student&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">8462</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[23]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>date_registration</th>
      <th>date_unregistration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14395</th>
      <td>DDD</td>
      <td>2013J</td>
      <td>8462</td>
      <td>-137.0</td>
      <td>119.0</td>
    </tr>
    <tr>
      <th>17560</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>8462</td>
      <td>-38.0</td>
      <td>18.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The new dataset is merged to the existing one</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sreg</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id_student&#39;</span><span class="p">,</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;code_module&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[25]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>date_unregistration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>28400</td>
      <td>Scotland</td>
      <td>HE Qualification</td>
      <td>20-30%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>215.0</td>
      <td>1220.0</td>
      <td>-53.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>30268</td>
      <td>North Western Region</td>
      <td>A Level or Equivalent</td>
      <td>30-40%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>1</td>
      <td>Withdrawn</td>
      <td>1</td>
      <td>102.0</td>
      <td>179.0</td>
      <td>-92.0</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>31604</td>
      <td>South East Region</td>
      <td>A Level or Equivalent</td>
      <td>50-60%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>169.0</td>
      <td>1989.0</td>
      <td>-52.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>32885</td>
      <td>West Midlands Region</td>
      <td>Lower Than A Level</td>
      <td>50-60%</td>
      <td>0-35</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>295.0</td>
      <td>739.0</td>
      <td>-176.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The old dataset is removed from memory, and the new merged dataset shown</span>
<span class="k">del</span> <span class="n">sreg</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 32593 entries, 0 to 32592
Data columns (total 16 columns):
 #   Column                Non-Null Count  Dtype  
---  ------                --------------  -----  
 0   code_module           32593 non-null  object 
 1   code_presentation     32593 non-null  object 
 2   id_student            32593 non-null  int64  
 3   region                32593 non-null  object 
 4   highest_education     32593 non-null  object 
 5   imd_band              31482 non-null  object 
 6   age_band              32593 non-null  object 
 7   num_of_prev_attempts  32593 non-null  int64  
 8   studied_credits       32593 non-null  int64  
 9   disability            32593 non-null  int32  
 10  final_result          32593 non-null  object 
 11  gender_F              32593 non-null  int32  
 12  vle_before            29228 non-null  float64
 13  vle_after             29228 non-null  float64
 14  date_registration     32548 non-null  float64
 15  date_unregistration   10072 non-null  float64
dtypes: float64(4), int32(2), int64(3), object(7)
memory usage: 4.0+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Courses-data">Courses data<a class="anchor-link" href="#Courses-data">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The courses dataset is read in</span>
<span class="n">courses</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;courses.csv&quot;</span><span class="p">)</span>
<span class="n">courses</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 22 entries, 0 to 21
Data columns (total 3 columns):
 #   Column                      Non-Null Count  Dtype 
---  ------                      --------------  ----- 
 0   code_module                 22 non-null     object
 1   code_presentation           22 non-null     object
 2   module_presentation_length  22 non-null     int64 
dtypes: int64(1), object(2)
memory usage: 656.0+ bytes
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">courses</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[28]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>module_presentation_length</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>268</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2014J</td>
      <td>269</td>
    </tr>
    <tr>
      <th>2</th>
      <td>BBB</td>
      <td>2013J</td>
      <td>268</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BBB</td>
      <td>2014J</td>
      <td>262</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BBB</td>
      <td>2013B</td>
      <td>240</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Again, this is a very simple dataset. Here, the distribution of the presentation length column is investigated.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Check the distribution of module presentation length</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">courses</span><span class="p">[</span><span class="s1">&#39;module_presentation_length&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Length (days)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram showing the distribution of module presentation length&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="output_41_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The module length distribution forms 2 clusters - modules will be assigned to a single new variable based on whether it is short or long, choosing the midpoint of 250 days as a cutoff.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Create the new variable, merge the datasets, and delete the orginal dataset</span>
<span class="n">courses</span><span class="p">[</span><span class="s1">&#39;module_long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">courses</span><span class="p">[</span><span class="s1">&#39;module_presentation_length&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">250</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">courses</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;code_module&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="k">del</span> <span class="n">courses</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[31]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>date_unregistration</th>
      <th>module_presentation_length</th>
      <th>module_long</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>28400</td>
      <td>Scotland</td>
      <td>HE Qualification</td>
      <td>20-30%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>215.0</td>
      <td>1220.0</td>
      <td>-53.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>30268</td>
      <td>North Western Region</td>
      <td>A Level or Equivalent</td>
      <td>30-40%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>1</td>
      <td>Withdrawn</td>
      <td>1</td>
      <td>102.0</td>
      <td>179.0</td>
      <td>-92.0</td>
      <td>12.0</td>
      <td>268</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>31604</td>
      <td>South East Region</td>
      <td>A Level or Equivalent</td>
      <td>50-60%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>169.0</td>
      <td>1989.0</td>
      <td>-52.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>32885</td>
      <td>West Midlands Region</td>
      <td>Lower Than A Level</td>
      <td>50-60%</td>
      <td>0-35</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>295.0</td>
      <td>739.0</td>
      <td>-176.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Assessments-data">Assessments data<a class="anchor-link" href="#Assessments-data">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The assessments data is read in</span>
<span class="n">assess</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;assessments.csv&quot;</span><span class="p">)</span>
<span class="n">assess</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 206 entries, 0 to 205
Data columns (total 6 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   code_module        206 non-null    object 
 1   code_presentation  206 non-null    object 
 2   id_assessment      206 non-null    int64  
 3   assessment_type    206 non-null    object 
 4   date               195 non-null    float64
 5   weight             206 non-null    float64
dtypes: float64(2), int64(1), object(3)
memory usage: 9.8+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assess</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[33]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_assessment</th>
      <th>assessment_type</th>
      <th>date</th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>1752</td>
      <td>TMA</td>
      <td>19.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>1753</td>
      <td>TMA</td>
      <td>54.0</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>1754</td>
      <td>TMA</td>
      <td>117.0</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>1755</td>
      <td>TMA</td>
      <td>166.0</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>1756</td>
      <td>TMA</td>
      <td>215.0</td>
      <td>30.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before the assessments data is merged to the general student dataframe (sdf), it may useful to examine the student assessment data first.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Student assessment data is read in</span>
<span class="n">stass</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;studentAssessment.csv&quot;</span><span class="p">)</span>
<span class="n">stass</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 173912 entries, 0 to 173911
Data columns (total 5 columns):
 #   Column          Non-Null Count   Dtype  
---  ------          --------------   -----  
 0   id_assessment   173912 non-null  int64  
 1   id_student      173912 non-null  int64  
 2   date_submitted  173912 non-null  int64  
 3   is_banked       173912 non-null  int64  
 4   score           173739 non-null  float64
dtypes: float64(1), int64(4)
memory usage: 6.6 MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stass</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[35]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_assessment</th>
      <th>id_student</th>
      <th>date_submitted</th>
      <th>is_banked</th>
      <th>score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1752</td>
      <td>11391</td>
      <td>18</td>
      <td>0</td>
      <td>78.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1752</td>
      <td>28400</td>
      <td>22</td>
      <td>0</td>
      <td>70.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1752</td>
      <td>31604</td>
      <td>17</td>
      <td>0</td>
      <td>72.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1752</td>
      <td>32885</td>
      <td>26</td>
      <td>0</td>
      <td>69.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1752</td>
      <td>38053</td>
      <td>19</td>
      <td>0</td>
      <td>79.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It makes sense to merge the two assessment datasets first, before combining with the general dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Both assessment datasets are merged into one, stass</span>
<span class="n">stass</span> <span class="o">=</span> <span class="n">stass</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">assess</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;id_assessment&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">stass</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 173912 entries, 0 to 173911
Data columns (total 10 columns):
 #   Column             Non-Null Count   Dtype  
---  ------             --------------   -----  
 0   id_assessment      173912 non-null  int64  
 1   id_student         173912 non-null  int64  
 2   date_submitted     173912 non-null  int64  
 3   is_banked          173912 non-null  int64  
 4   score              173739 non-null  float64
 5   code_module        173912 non-null  object 
 6   code_presentation  173912 non-null  object 
 7   assessment_type    173912 non-null  object 
 8   date               171047 non-null  float64
 9   weight             173912 non-null  float64
dtypes: float64(3), int64(4), object(3)
memory usage: 14.6+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The original assessment dataset is deleted from memory</span>
<span class="k">del</span> <span class="n">assess</span>
<span class="n">stass</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[37]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_assessment</th>
      <th>id_student</th>
      <th>date_submitted</th>
      <th>is_banked</th>
      <th>score</th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>assessment_type</th>
      <th>date</th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1752</td>
      <td>11391</td>
      <td>18</td>
      <td>0</td>
      <td>78.0</td>
      <td>AAA</td>
      <td>2013J</td>
      <td>TMA</td>
      <td>19.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1752</td>
      <td>28400</td>
      <td>22</td>
      <td>0</td>
      <td>70.0</td>
      <td>AAA</td>
      <td>2013J</td>
      <td>TMA</td>
      <td>19.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1752</td>
      <td>31604</td>
      <td>17</td>
      <td>0</td>
      <td>72.0</td>
      <td>AAA</td>
      <td>2013J</td>
      <td>TMA</td>
      <td>19.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1752</td>
      <td>32885</td>
      <td>26</td>
      <td>0</td>
      <td>69.0</td>
      <td>AAA</td>
      <td>2013J</td>
      <td>TMA</td>
      <td>19.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1752</td>
      <td>38053</td>
      <td>19</td>
      <td>0</td>
      <td>79.0</td>
      <td>AAA</td>
      <td>2013J</td>
      <td>TMA</td>
      <td>19.0</td>
      <td>10.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are several rows with missing data in the 'date' field. This is examined to find that the rows with empty dates correspond to end of module exams only - this can be filled in later if necessary using module length data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stass</span><span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">stass</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stass</span><span class="p">[</span><span class="s1">&#39;assessment_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Exam&#39;</span><span class="p">)</span> <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[38]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_assessment</th>
      <th>id_student</th>
      <th>date_submitted</th>
      <th>is_banked</th>
      <th>score</th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>assessment_type</th>
      <th>date</th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The 2 date columns are reduced to 1, capturing the necessary information regarding how far in advance of a deadline the work was submitted.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Create new column and drop the original two</span>
<span class="n">stass</span><span class="p">[</span><span class="s1">&#39;date_submit_advance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stass</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">stass</span><span class="p">[</span><span class="s1">&#39;date_submitted&#39;</span><span class="p">]</span>
<span class="n">stass</span> <span class="o">=</span> <span class="n">stass</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;date_submitted&#39;</span><span class="p">])</span>
<span class="n">stass</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[39]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_assessment</th>
      <th>id_student</th>
      <th>is_banked</th>
      <th>score</th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>assessment_type</th>
      <th>weight</th>
      <th>date_submit_advance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1752</td>
      <td>11391</td>
      <td>0</td>
      <td>78.0</td>
      <td>AAA</td>
      <td>2013J</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1752</td>
      <td>28400</td>
      <td>0</td>
      <td>70.0</td>
      <td>AAA</td>
      <td>2013J</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>-3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1752</td>
      <td>31604</td>
      <td>0</td>
      <td>72.0</td>
      <td>AAA</td>
      <td>2013J</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1752</td>
      <td>32885</td>
      <td>0</td>
      <td>69.0</td>
      <td>AAA</td>
      <td>2013J</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>-7.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1752</td>
      <td>38053</td>
      <td>0</td>
      <td>79.0</td>
      <td>AAA</td>
      <td>2013J</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The assessment data can now be merged with the general dataset</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">stass</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id_student&#39;</span><span class="p">,</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;code_module&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="VLE-data">VLE data<a class="anchor-link" href="#VLE-data">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The vle dataset is read in</span>
<span class="n">vle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;vle.csv&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vle</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vle</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>   id_site code_module code_presentation activity_type  week_from  week_to
0   546943         AAA             2013J      resource        NaN      NaN
1   546712         AAA             2013J     oucontent        NaN      NaN
2   546998         AAA             2013J      resource        NaN      NaN
3   546888         AAA             2013J           url        NaN      NaN
4   547035         AAA             2013J      resource        NaN      NaN
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 6364 entries, 0 to 6363
Data columns (total 6 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   id_site            6364 non-null   int64  
 1   code_module        6364 non-null   object 
 2   code_presentation  6364 non-null   object 
 3   activity_type      6364 non-null   object 
 4   week_from          1121 non-null   float64
 5   week_to            1121 non-null   float64
dtypes: float64(2), int64(1), object(3)
memory usage: 298.4+ KB
None
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Looking at the schematic and description for vle.csv, this does not appear to contain worthwhile information, and looking at the data, there is too much missing data here to be useful. At this stage, a decision is made to exclude vle.csv from the dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The vle dataset is removed from memory</span>
<span class="k">del</span> <span class="n">vle</span>
<span class="c1"># All datasets (except vle) is now merged into sdf</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 180662 entries, 0 to 180661
Data columns (total 24 columns):
 #   Column                      Non-Null Count   Dtype  
---  ------                      --------------   -----  
 0   code_module                 180662 non-null  object 
 1   code_presentation           180662 non-null  object 
 2   id_student                  180662 non-null  int64  
 3   region                      180662 non-null  object 
 4   highest_education           180662 non-null  object 
 5   imd_band                    172852 non-null  object 
 6   age_band                    180662 non-null  object 
 7   num_of_prev_attempts        180662 non-null  int64  
 8   studied_credits             180662 non-null  int64  
 9   disability                  180662 non-null  int32  
 10  final_result                180662 non-null  object 
 11  gender_F                    180662 non-null  int32  
 12  vle_before                  177179 non-null  float64
 13  vle_after                   177179 non-null  float64
 14  date_registration           180614 non-null  float64
 15  date_unregistration         18454 non-null   float64
 16  module_presentation_length  180662 non-null  int64  
 17  module_long                 180662 non-null  int32  
 18  id_assessment               173912 non-null  float64
 19  is_banked                   173912 non-null  float64
 20  score                       173739 non-null  float64
 21  assessment_type             173912 non-null  object 
 22  weight                      173912 non-null  float64
 23  date_submit_advance         171047 non-null  float64
dtypes: float64(9), int32(3), int64(4), object(8)
memory usage: 32.4+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Feature-Engineering-and-Dataset-Reduction">Feature Engineering and Dataset Reduction<a class="anchor-link" href="#Feature-Engineering-and-Dataset-Reduction">&#182;</a></h1><p>Whilst some feature engineering took place as the datasets were merged, now that there is one single dataset to work with, further feature engineering can take place.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Display all columns</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[43]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>date_unregistration</th>
      <th>module_presentation_length</th>
      <th>module_long</th>
      <th>id_assessment</th>
      <th>is_banked</th>
      <th>score</th>
      <th>assessment_type</th>
      <th>weight</th>
      <th>date_submit_advance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1752.0</td>
      <td>0.0</td>
      <td>78.0</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1753.0</td>
      <td>0.0</td>
      <td>85.0</td>
      <td>TMA</td>
      <td>20.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1754.0</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>TMA</td>
      <td>20.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1755.0</td>
      <td>0.0</td>
      <td>85.0</td>
      <td>TMA</td>
      <td>20.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1756.0</td>
      <td>0.0</td>
      <td>82.0</td>
      <td>TMA</td>
      <td>30.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Student 8462 is again picked out, to gain a better understanding of the dataset as is</span>
<span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;id_student&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">8462</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[44]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>date_unregistration</th>
      <th>module_presentation_length</th>
      <th>module_long</th>
      <th>id_assessment</th>
      <th>is_banked</th>
      <th>score</th>
      <th>assessment_type</th>
      <th>weight</th>
      <th>date_submit_advance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>78629</th>
      <td>DDD</td>
      <td>2013J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>90</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>81.0</td>
      <td>565.0</td>
      <td>-137.0</td>
      <td>119.0</td>
      <td>261</td>
      <td>1</td>
      <td>25348.0</td>
      <td>0.0</td>
      <td>93.0</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>-4.0</td>
    </tr>
    <tr>
      <th>78630</th>
      <td>DDD</td>
      <td>2013J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>90</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>81.0</td>
      <td>565.0</td>
      <td>-137.0</td>
      <td>119.0</td>
      <td>261</td>
      <td>1</td>
      <td>25349.0</td>
      <td>0.0</td>
      <td>83.0</td>
      <td>TMA</td>
      <td>12.5</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>78631</th>
      <td>DDD</td>
      <td>2013J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>90</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>81.0</td>
      <td>565.0</td>
      <td>-137.0</td>
      <td>119.0</td>
      <td>261</td>
      <td>1</td>
      <td>25350.0</td>
      <td>0.0</td>
      <td>87.0</td>
      <td>TMA</td>
      <td>17.5</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>91821</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>1</td>
      <td>60</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>-38.0</td>
      <td>18.0</td>
      <td>262</td>
      <td>1</td>
      <td>25362.0</td>
      <td>1.0</td>
      <td>93.0</td>
      <td>TMA</td>
      <td>5.0</td>
      <td>21.0</td>
    </tr>
    <tr>
      <th>91822</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>1</td>
      <td>60</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>-38.0</td>
      <td>18.0</td>
      <td>262</td>
      <td>1</td>
      <td>25363.0</td>
      <td>1.0</td>
      <td>83.0</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>91823</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>1</td>
      <td>60</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>-38.0</td>
      <td>18.0</td>
      <td>262</td>
      <td>1</td>
      <td>25364.0</td>
      <td>1.0</td>
      <td>83.0</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>63.0</td>
    </tr>
    <tr>
      <th>91824</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>1</td>
      <td>60</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>-38.0</td>
      <td>18.0</td>
      <td>262</td>
      <td>1</td>
      <td>25365.0</td>
      <td>1.0</td>
      <td>87.0</td>
      <td>TMA</td>
      <td>25.0</td>
      <td>112.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We now have a combined dataset with multiple entries per student, due to multiple assessments and multiple sittings of a module. As we are looking to predict a student withdrawing or failing for any given attempt at a module, it would be useful to get a single row of data per student per module.</p>
<p>The exam result is separated into its own column, but first the weighting needs to be checked. This is becuase we want to look at students who fail or withdraw. An average score &lt;40 over the coursework and exam counts as a fail, so these need to be considered separately.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Look at exam weightings</span>
<span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;assessment_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Exam&#39;</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[45]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>count    4959.0
mean      100.0
std         0.0
min       100.0
25%       100.0
50%       100.0
75%       100.0
max       100.0
Name: weight, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This shows us that where exams are used, they are all weighted as 100% in the data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The exam scores are extracted from the dataset</span>
<span class="n">exam_score</span> <span class="o">=</span> <span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;assessment_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Exam&#39;</span><span class="p">][[</span><span class="s1">&#39;code_module&#39;</span><span class="p">,</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;id_student&#39;</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">]]</span>
<span class="n">exam_score</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span><span class="s1">&#39;exam_score&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">exam_score</span>
<span class="c1">#exam_score[&#39;code_module&#39;].unique()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[46]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>exam_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>48066</th>
      <td>CCC</td>
      <td>2014B</td>
      <td>29764</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>48075</th>
      <td>CCC</td>
      <td>2014B</td>
      <td>29820</td>
      <td>76.0</td>
    </tr>
    <tr>
      <th>48083</th>
      <td>CCC</td>
      <td>2014B</td>
      <td>40604</td>
      <td>66.0</td>
    </tr>
    <tr>
      <th>48092</th>
      <td>CCC</td>
      <td>2014B</td>
      <td>42638</td>
      <td>50.0</td>
    </tr>
    <tr>
      <th>48104</th>
      <td>CCC</td>
      <td>2014B</td>
      <td>46605</td>
      <td>98.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>100172</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>2677210</td>
      <td>71.0</td>
    </tr>
    <tr>
      <th>100179</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>2678380</td>
      <td>64.0</td>
    </tr>
    <tr>
      <th>100192</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>2684043</td>
      <td>69.0</td>
    </tr>
    <tr>
      <th>100199</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>2685863</td>
      <td>49.0</td>
    </tr>
    <tr>
      <th>100206</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>2689863</td>
      <td>67.0</td>
    </tr>
  </tbody>
</table>
<p>4959 rows  4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The exams scores are merged back to the dataset as a new column</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">exam_score</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;code_module&#39;</span><span class="p">,</span><span class="s1">&#39;id_student&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;assessment_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Exam&#39;</span><span class="p">]</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[47]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>date_unregistration</th>
      <th>module_presentation_length</th>
      <th>module_long</th>
      <th>id_assessment</th>
      <th>is_banked</th>
      <th>score</th>
      <th>assessment_type</th>
      <th>weight</th>
      <th>date_submit_advance</th>
      <th>exam_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1752.0</td>
      <td>0.0</td>
      <td>78.0</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1753.0</td>
      <td>0.0</td>
      <td>85.0</td>
      <td>TMA</td>
      <td>20.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1754.0</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>TMA</td>
      <td>20.0</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1755.0</td>
      <td>0.0</td>
      <td>85.0</td>
      <td>TMA</td>
      <td>20.0</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1756.0</td>
      <td>0.0</td>
      <td>82.0</td>
      <td>TMA</td>
      <td>30.0</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to find the weighted average of scores for the coursework. It is not sufficient to do this in a simple weighted average aggregate function, as those students who have withdrawn may not have completed all coursework, so their weights will not add up to 100. One option to avoid the risk of scoring out of 100 and artificially deflating the scores of Withdrawn students would be to write a bespoke function to run within the aggregator. However, it is much simpler to run calculations on the data and add/remove calculation columns as appropriate to reach weighted averages for where the course has been completed and where the course has not been completed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Three modules were identified as using some zero-weighted coursework, i.e. coursework that does not count towards the final mark. Module GGG has no coursework that counts towards the final grade. This type of coursework may be treated differently by students and thus provide a different type of data. The 'counted' coursework and 'uncounted' coursework scores will therefore be split into different variables accordingly.
Additionally, where a student withdraws, the weighting of their scores should be by the amount of coursework they completed before withdrawing - this will not add up to 100, so will need to be calculated separately based on the individual completed weightings per student. The two 'counted' columns will therefore be distinguished by 'counted score weighted', based on the amount of coursework that was completed, and 'counted score 100' where the score is weighted out of 100 as if the student submitted all coursework. 'Counted score 100' will therefore typically be a lower value for students that withdraw.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Identify any modules using zero-weighted coursework.</span>
<span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;code_module&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="c1"># Module GGG has no coursework that counts towards the final grade.</span>
<span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;code_module&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GGG&#39;</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># Split off weights, and use these to generate weighted score columns.</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;code_module&#39;</span><span class="p">,</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;id_student&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_cw_weight</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span><span class="s1">&#39;sum&#39;</span><span class="p">))</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;code_module&#39;</span><span class="p">,</span><span class="s1">&#39;id_student&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="c1"># Use a float64 number type to output NaN when dividing by zero rather than an error</span>
<span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;counted_score_weighted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;total_cw_weight&#39;</span><span class="p">]</span>
<span class="c1"># Counted score weighted is now set as the weighted proportion of the total coursework mark achieved</span>
<span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;counted_score_w100&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
<span class="c1"># Counted score 100 gives the weighted proportion of total coursework out of 100</span>
<span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;uncounted_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]),</span> <span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>

<span class="n">sdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[48]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>date_unregistration</th>
      <th>module_presentation_length</th>
      <th>module_long</th>
      <th>id_assessment</th>
      <th>is_banked</th>
      <th>score</th>
      <th>assessment_type</th>
      <th>weight</th>
      <th>date_submit_advance</th>
      <th>exam_score</th>
      <th>total_cw_weight</th>
      <th>counted_score_weighted</th>
      <th>counted_score_w100</th>
      <th>uncounted_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1752.0</td>
      <td>0.0</td>
      <td>78.0</td>
      <td>TMA</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>100.0</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1753.0</td>
      <td>0.0</td>
      <td>85.0</td>
      <td>TMA</td>
      <td>20.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>100.0</td>
      <td>17.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1754.0</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>TMA</td>
      <td>20.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>100.0</td>
      <td>16.0</td>
      <td>16.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1755.0</td>
      <td>0.0</td>
      <td>85.0</td>
      <td>TMA</td>
      <td>20.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>100.0</td>
      <td>17.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>1756.0</td>
      <td>0.0</td>
      <td>82.0</td>
      <td>TMA</td>
      <td>30.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>100.0</td>
      <td>24.6</td>
      <td>24.6</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[49]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Check if any entries have no scores</span>
<span class="n">sdf</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;final_result&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Pass&#39;</span><span class="p">)</span> <span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[49]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>date_unregistration</th>
      <th>module_presentation_length</th>
      <th>module_long</th>
      <th>id_assessment</th>
      <th>is_banked</th>
      <th>score</th>
      <th>assessment_type</th>
      <th>weight</th>
      <th>date_submit_advance</th>
      <th>exam_score</th>
      <th>total_cw_weight</th>
      <th>counted_score_weighted</th>
      <th>counted_score_w100</th>
      <th>uncounted_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2790</th>
      <td>AAA</td>
      <td>2014J</td>
      <td>1336190</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>80-90%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>86.0</td>
      <td>935.0</td>
      <td>-23.0</td>
      <td>NaN</td>
      <td>269</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7225</th>
      <td>BBB</td>
      <td>2013B</td>
      <td>502717</td>
      <td>Wales</td>
      <td>Lower Than A Level</td>
      <td>80-90%</td>
      <td>0-35</td>
      <td>1</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>30.0</td>
      <td>1911.0</td>
      <td>-21.0</td>
      <td>NaN</td>
      <td>240</td>
      <td>0</td>
      <td>14989.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>TMA</td>
      <td>18.0</td>
      <td>-29.0</td>
      <td>NaN</td>
      <td>81.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7823</th>
      <td>BBB</td>
      <td>2013B</td>
      <td>515497</td>
      <td>London Region</td>
      <td>A Level or Equivalent</td>
      <td>0-10%</td>
      <td>0-35</td>
      <td>0</td>
      <td>120</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>15.0</td>
      <td>146.0</td>
      <td>-24.0</td>
      <td>NaN</td>
      <td>240</td>
      <td>0</td>
      <td>14989.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>TMA</td>
      <td>18.0</td>
      <td>-32.0</td>
      <td>NaN</td>
      <td>97.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>16490</th>
      <td>BBB</td>
      <td>2013J</td>
      <td>342685</td>
      <td>Scotland</td>
      <td>A Level or Equivalent</td>
      <td>30-40%</td>
      <td>0-35</td>
      <td>0</td>
      <td>60</td>
      <td>1</td>
      <td>Pass</td>
      <td>1</td>
      <td>16.0</td>
      <td>767.0</td>
      <td>-32.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>14998.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>TMA</td>
      <td>18.0</td>
      <td>-36.0</td>
      <td>NaN</td>
      <td>99.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>16554</th>
      <td>BBB</td>
      <td>2013J</td>
      <td>352688</td>
      <td>South Region</td>
      <td>A Level or Equivalent</td>
      <td>70-80%</td>
      <td>0-35</td>
      <td>0</td>
      <td>210</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>67.0</td>
      <td>416.0</td>
      <td>-54.0</td>
      <td>NaN</td>
      <td>268</td>
      <td>1</td>
      <td>15001.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>TMA</td>
      <td>18.0</td>
      <td>-1.0</td>
      <td>NaN</td>
      <td>100.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We see that there are ~7000 entries with no scores - some who have failed (through non-submission?) or withdrawn, but some have also passed (with no exam or counted score), possibly suggesting missing or corrupted data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This dataset needs aggregating to get to one row representing one student per module per module presentation. The aggregate function accepts a dictionary that will define how to aggregate over each field.
This allows us to drop unnecessary fields also:</p>
<ul>
<li>Date of unregistration is not an interesting input - we just need to know whether they unregistered (i.e. withdrew), not when.</li>
<li>ID of assessment is not necessary to keep in the data as it provides no quantitative information.</li>
<li>The Banked status of assessments are not being distinguished in the dataset as this is an unnecessary complication - each attempt at a module is considered separately, and the fact that this may be an additional attempt at a module is already captured by the 'number of previous attempts' column.</li>
<li>Score has been converted to new columns as above so is no longer needed.</li>
<li>Assessment type seems arbitrary, other than the 'Exam' type, which has already been separated out.</li>
<li>Weighting was used to find a weighted average score, but does not need to be maintained in the final dataset.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[50]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initialise a dictionary for the aggregate function</span>
<span class="n">aggDict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># Iterate through columns, calculating on each as appropriate</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">sdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date_unregistration&#39;</span><span class="p">,</span><span class="s1">&#39;id_assessment&#39;</span><span class="p">,</span><span class="s1">&#39;is_banked&#39;</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">,</span><span class="s1">&#39;assessment_type&#39;</span><span class="p">,</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span><span class="s1">&#39;total_cw_weight&#39;</span><span class="p">]:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;counted_score_weighted&#39;</span><span class="p">,</span><span class="s1">&#39;counted_score_w100&#39;</span><span class="p">,</span><span class="s1">&#39;uncounted_score&#39;</span><span class="p">]:</span>
        <span class="n">aggDict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sum&#39;</span>
    <span class="k">elif</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date_submit_advance&#39;</span><span class="p">,</span><span class="s1">&#39;module_presentation_length&#39;</span><span class="p">]:</span>
        <span class="n">aggDict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">aggDict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span>
<span class="n">aggDict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[50]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>{&#39;code_module&#39;: &#39;first&#39;,
 &#39;code_presentation&#39;: &#39;first&#39;,
 &#39;id_student&#39;: &#39;first&#39;,
 &#39;region&#39;: &#39;first&#39;,
 &#39;highest_education&#39;: &#39;first&#39;,
 &#39;imd_band&#39;: &#39;first&#39;,
 &#39;age_band&#39;: &#39;first&#39;,
 &#39;num_of_prev_attempts&#39;: &#39;first&#39;,
 &#39;studied_credits&#39;: &#39;first&#39;,
 &#39;disability&#39;: &#39;first&#39;,
 &#39;final_result&#39;: &#39;first&#39;,
 &#39;gender_F&#39;: &#39;first&#39;,
 &#39;vle_before&#39;: &#39;first&#39;,
 &#39;vle_after&#39;: &#39;first&#39;,
 &#39;date_registration&#39;: &#39;first&#39;,
 &#39;module_presentation_length&#39;: &#39;mean&#39;,
 &#39;module_long&#39;: &#39;first&#39;,
 &#39;date_submit_advance&#39;: &#39;mean&#39;,
 &#39;exam_score&#39;: &#39;first&#39;,
 &#39;counted_score_weighted&#39;: &#39;sum&#39;,
 &#39;counted_score_w100&#39;: &#39;sum&#39;,
 &#39;uncounted_score&#39;: &#39;sum&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[51]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The data is aggregated and the index reset</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;code_module&#39;</span><span class="p">,</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;id_student&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggDict</span><span class="p">)</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 32589 entries, 0 to 32588
Data columns (total 22 columns):
 #   Column                      Non-Null Count  Dtype  
---  ------                      --------------  -----  
 0   code_module                 32589 non-null  object 
 1   code_presentation           32589 non-null  object 
 2   id_student                  32589 non-null  int64  
 3   region                      32589 non-null  object 
 4   highest_education           32589 non-null  object 
 5   imd_band                    31478 non-null  object 
 6   age_band                    32589 non-null  object 
 7   num_of_prev_attempts        32589 non-null  int64  
 8   studied_credits             32589 non-null  int64  
 9   disability                  32589 non-null  int32  
 10  final_result                32589 non-null  object 
 11  gender_F                    32589 non-null  int32  
 12  vle_before                  29225 non-null  float64
 13  vle_after                   29225 non-null  float64
 14  date_registration           32544 non-null  float64
 15  module_presentation_length  32589 non-null  int64  
 16  module_long                 32589 non-null  int32  
 17  date_submit_advance         25839 non-null  float64
 18  exam_score                  4955 non-null   float64
 19  counted_score_weighted      32589 non-null  float64
 20  counted_score_w100          32589 non-null  float64
 21  uncounted_score             32589 non-null  float64
dtypes: float64(8), int32(3), int64(4), object(7)
memory usage: 5.1+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Cleaning-the-Dataset">Cleaning the Dataset<a class="anchor-link" href="#Cleaning-the-Dataset">&#182;</a></h1><p>Now that there is one student per module per presentation, we need to create a new score column for average of 'exam score' and 'counted score w100' - if this is &gt;=40, the student passes. It is worth noting that in the dataset, some students with scores &lt;40 still pass - this is presumably due to extenuating circumstances or errors in data - this is impossible to predict for using the data provided. Instead, we assume the Open University's 40% passmark is consistent and therefore use regression to predict marks to determine pass/fail. This 'av_score' will be the target for regression (predicting fail via average score).
The counted_score_weighted will be an independent variable for the classifier only, as it will be highly correlated with the av_score, but may be useful in predicting withdrawals. A new column is made for one-hot encoding withdrawals as the target variable for classification.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[53]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Create target variable for regression based on average exam and counted coursework score and remove the original columns</span>
<span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;av_cscore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">([</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;exam_score&#39;</span><span class="p">],</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;counted_score_w100&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;counted_score_w100&#39;</span><span class="p">,</span><span class="s1">&#39;exam_score&#39;</span><span class="p">])</span>

<span class="c1">#  Create target variable for classification, &#39;Withdrawn&#39;</span>
<span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;withdrawn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;final_result&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Withdrawn&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[53]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>module_presentation_length</th>
      <th>module_long</th>
      <th>date_submit_advance</th>
      <th>counted_score_weighted</th>
      <th>uncounted_score</th>
      <th>av_cscore</th>
      <th>withdrawn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>11391</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>268</td>
      <td>1</td>
      <td>1.8</td>
      <td>82.4</td>
      <td>0.0</td>
      <td>82.4</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>28400</td>
      <td>Scotland</td>
      <td>HE Qualification</td>
      <td>20-30%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>215.0</td>
      <td>1220.0</td>
      <td>-53.0</td>
      <td>268</td>
      <td>1</td>
      <td>0.0</td>
      <td>65.4</td>
      <td>0.0</td>
      <td>65.4</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>30268</td>
      <td>North Western Region</td>
      <td>A Level or Equivalent</td>
      <td>30-40%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>1</td>
      <td>Withdrawn</td>
      <td>1</td>
      <td>102.0</td>
      <td>179.0</td>
      <td>-92.0</td>
      <td>268</td>
      <td>1</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>31604</td>
      <td>South East Region</td>
      <td>A Level or Equivalent</td>
      <td>50-60%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>169.0</td>
      <td>1989.0</td>
      <td>-52.0</td>
      <td>268</td>
      <td>1</td>
      <td>2.0</td>
      <td>76.3</td>
      <td>0.0</td>
      <td>76.3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>2013J</td>
      <td>32885</td>
      <td>West Midlands Region</td>
      <td>Lower Than A Level</td>
      <td>50-60%</td>
      <td>0-35</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>295.0</td>
      <td>739.0</td>
      <td>-176.0</td>
      <td>268</td>
      <td>1</td>
      <td>-11.4</td>
      <td>55.0</td>
      <td>0.0</td>
      <td>55.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[54]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Student 8462 is picked out again to see the dataset progress</span>
<span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;id_student&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">8462</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[54]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>code_presentation</th>
      <th>id_student</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>module_presentation_length</th>
      <th>module_long</th>
      <th>date_submit_advance</th>
      <th>counted_score_weighted</th>
      <th>uncounted_score</th>
      <th>av_cscore</th>
      <th>withdrawn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14395</th>
      <td>DDD</td>
      <td>2013J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>90</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>81.0</td>
      <td>565.0</td>
      <td>-137.0</td>
      <td>261</td>
      <td>1</td>
      <td>0.333333</td>
      <td>87.25</td>
      <td>0.0</td>
      <td>34.9</td>
      <td>1</td>
    </tr>
    <tr>
      <th>17557</th>
      <td>DDD</td>
      <td>2014J</td>
      <td>8462</td>
      <td>London Region</td>
      <td>HE Qualification</td>
      <td>30-40%</td>
      <td>55&lt;=</td>
      <td>1</td>
      <td>60</td>
      <td>0</td>
      <td>Withdrawn</td>
      <td>0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>-38.0</td>
      <td>262</td>
      <td>1</td>
      <td>59.500000</td>
      <td>86.00</td>
      <td>0.0</td>
      <td>43.0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The code presentation column will be dropped - this is because, whilst prediction models can use this variable, it is arbitrary to predict using date variables in the past without a time series approach. Whilst using this variable here may help the model in prediction when this dataset is split, this model would not be able to adapt to any future presentations of modules as these would have a 'code_presentation' outside of this dataset. This would make the module useless in practise.
The 'id_student' column will also be dropped - this is a decision made that each attempt at a module is a separate event, and we are aiming to predict whether on any given attempt at a module the student will fail or withdraw. This is why we are not grouping by student id, and this column can now be dropped.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[55]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;code_presentation&#39;</span><span class="p">,</span><span class="s1">&#39;id_student&#39;</span><span class="p">])</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[55]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code_module</th>
      <th>region</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>module_presentation_length</th>
      <th>module_long</th>
      <th>date_submit_advance</th>
      <th>counted_score_weighted</th>
      <th>uncounted_score</th>
      <th>av_cscore</th>
      <th>withdrawn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAA</td>
      <td>East Anglian Region</td>
      <td>HE Qualification</td>
      <td>90-100%</td>
      <td>55&lt;=</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>268</td>
      <td>1</td>
      <td>1.8</td>
      <td>82.4</td>
      <td>0.0</td>
      <td>82.4</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAA</td>
      <td>Scotland</td>
      <td>HE Qualification</td>
      <td>20-30%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>215.0</td>
      <td>1220.0</td>
      <td>-53.0</td>
      <td>268</td>
      <td>1</td>
      <td>0.0</td>
      <td>65.4</td>
      <td>0.0</td>
      <td>65.4</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAA</td>
      <td>North Western Region</td>
      <td>A Level or Equivalent</td>
      <td>30-40%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>1</td>
      <td>Withdrawn</td>
      <td>1</td>
      <td>102.0</td>
      <td>179.0</td>
      <td>-92.0</td>
      <td>268</td>
      <td>1</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAA</td>
      <td>South East Region</td>
      <td>A Level or Equivalent</td>
      <td>50-60%</td>
      <td>35-55</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>169.0</td>
      <td>1989.0</td>
      <td>-52.0</td>
      <td>268</td>
      <td>1</td>
      <td>2.0</td>
      <td>76.3</td>
      <td>0.0</td>
      <td>76.3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAA</td>
      <td>West Midlands Region</td>
      <td>Lower Than A Level</td>
      <td>50-60%</td>
      <td>0-35</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>295.0</td>
      <td>739.0</td>
      <td>-176.0</td>
      <td>268</td>
      <td>1</td>
      <td>-11.4</td>
      <td>55.0</td>
      <td>0.0</td>
      <td>55.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The difference between module code and module presentation length was examined, as these columns may be recording the same information in different ways. However this was not the case, as the module length varies across all modules.
Whilst there is not a large spread in presentation length, the module length does not appear to be constant with regards to module code. However, module length has been encoded as short and long, so the original column will be dropped at this point.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[56]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">modCode</span> <span class="ow">in</span> <span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;code_module&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">modCode</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;code_module&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">modCode</span><span class="p">][</span><span class="s1">&#39;module_presentation_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;module_presentation_length&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>AAA
[268 269]
BBB
[240 268 234 262]
CCC
[241 269]
DDD
[240 261 241 262]
EEE
[268 241 269]
FFF
[240 268 241 269]
GGG
[261 241 269]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are several categorical variables in our dataset. For the sake of machine learning algorithms, these need to be numerically encoded. To give a better idea of what the dataset contains, value counts are made for each categorical column</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[57]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Print column names</span>
<span class="c1">#for col in sdf.columns:</span>
<span class="c1">#    print(&quot;&#39;{}&#39;&quot;.format(col), end=&quot;, &quot;, flush=True)</span>

<span class="c1"># Print categorical column value counts</span>
<span class="n">catCol</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;code_module&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;highest_education&#39;</span><span class="p">,</span> <span class="s1">&#39;imd_band&#39;</span><span class="p">,</span> <span class="s1">&#39;age_band&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">catCol</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>BBB    7909
FFF    7762
DDD    6268
CCC    4434
EEE    2934
GGG    2534
AAA     748
Name: code_module, dtype: int64


Scotland                3446
East Anglian Region     3340
London Region           3214
South Region            3091
North Western Region    2906
West Midlands Region    2582
South West Region       2436
East Midlands Region    2365
South East Region       2111
Wales                   2085
Yorkshire Region        2006
North Region            1823
Ireland                 1184
Name: region, dtype: int64


A Level or Equivalent          14043
Lower Than A Level             13157
HE Qualification                4729
No Formal quals                  347
Post Graduate Qualification      313
Name: highest_education, dtype: int64


20-30%     3654
30-40%     3539
10-20      3516
0-10%      3310
40-50%     3254
50-60%     3124
60-70%     2905
70-80%     2878
80-90%     2762
90-100%    2536
Name: imd_band, dtype: int64


0-35     22941
35-55     9432
55&lt;=       216
Name: age_band, dtype: int64


</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are no excessively small categories in any of the categorical data columns. The code_module and region columns contain nominal data, so will be one-hot encoded to new columns. The other 3 columns contain ordinal data, so each will have their categories labelled in a new single numeric column.</p>
<p>The nominal categories are multicolinear, and one column could be dropped from each set and retain the same information. However, this is only an issue where a non-regularised linear model is used - where regularisation or other model types are utilised, it is fine to maintain multicolinear variables in the dataset, and removing one category can affect the prediction depending on which is removed. All categories are therefore encoded (inmachineswetrust.com/posts/drop-first-columns).</p>
<p>The ordinal category encoding could be executed with LabelEncoder, but there are not many categories and a replace method with explicit encoding allows later referral and potentially simpler modification of the encoding method.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[58]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Define which categories are nominal</span>
<span class="n">nomCat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;code_module&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">]</span>
<span class="c1"># Encode nominal categories</span>
<span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">nomCat</span><span class="p">:</span>
    <span class="n">catDummy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="n">cat</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="n">cat</span><span class="p">)</span>
    <span class="n">sdf</span> <span class="o">=</span> <span class="n">catDummy</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sdf</span><span class="p">)</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">nomCat</span><span class="p">)</span>

<span class="c1"># Define and encode ordinal categories</span>
<span class="n">ordCat</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;highest_education&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">&#39;No Formal quals&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s1">&#39;Lower Than A Level&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s1">&#39;A Level or Equivalent&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s1">&#39;HE Qualification&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="s1">&#39;Post Graduate Qualification&#39;</span><span class="p">:</span> <span class="mi">4</span>
  <span class="p">},</span>
  <span class="s1">&#39;imd_band&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">&#39;0-10%&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s1">&#39;10-20&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s1">&#39;20-30%&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s1">&#39;30-40%&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="s1">&#39;40-50%&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="s1">&#39;50-60%&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s1">&#39;60-70%&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="s1">&#39;70-80%&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
      <span class="s1">&#39;80-90%&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
      <span class="s1">&#39;90-100%&#39;</span><span class="p">:</span> <span class="mi">9</span>
  <span class="p">},</span>
  <span class="s1">&#39;age_band&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">&#39;0-35&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s1">&#39;35-55&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s1">&#39;55&lt;=&#39;</span><span class="p">:</span> <span class="mi">2</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ordCat</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Looking at the uncounted score variable, this is only available for ~27% of the data rows - this is impractical to work with and unlikely to be very informative as it is ungraded, so this column is dropped.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[59]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;uncounted_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sdf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[59]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>1.0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[60]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;uncounted_score&#39;</span><span class="p">)</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[60]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region_East Anglian Region</th>
      <th>region_East Midlands Region</th>
      <th>region_Ireland</th>
      <th>region_London Region</th>
      <th>region_North Region</th>
      <th>region_North Western Region</th>
      <th>region_Scotland</th>
      <th>region_South East Region</th>
      <th>region_South Region</th>
      <th>region_South West Region</th>
      <th>region_Wales</th>
      <th>region_West Midlands Region</th>
      <th>region_Yorkshire Region</th>
      <th>code_module_AAA</th>
      <th>code_module_BBB</th>
      <th>code_module_CCC</th>
      <th>code_module_DDD</th>
      <th>code_module_EEE</th>
      <th>code_module_FFF</th>
      <th>code_module_GGG</th>
      <th>highest_education</th>
      <th>imd_band</th>
      <th>age_band</th>
      <th>num_of_prev_attempts</th>
      <th>studied_credits</th>
      <th>disability</th>
      <th>final_result</th>
      <th>gender_F</th>
      <th>vle_before</th>
      <th>vle_after</th>
      <th>date_registration</th>
      <th>module_long</th>
      <th>date_submit_advance</th>
      <th>counted_score_weighted</th>
      <th>av_cscore</th>
      <th>withdrawn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>9.0</td>
      <td>2</td>
      <td>0</td>
      <td>240</td>
      <td>0</td>
      <td>Pass</td>
      <td>0</td>
      <td>98.0</td>
      <td>836.0</td>
      <td>-159.0</td>
      <td>1</td>
      <td>1.8</td>
      <td>82.4</td>
      <td>82.4</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>2.0</td>
      <td>1</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>215.0</td>
      <td>1220.0</td>
      <td>-53.0</td>
      <td>1</td>
      <td>0.0</td>
      <td>65.4</td>
      <td>65.4</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>3.0</td>
      <td>1</td>
      <td>0</td>
      <td>60</td>
      <td>1</td>
      <td>Withdrawn</td>
      <td>1</td>
      <td>102.0</td>
      <td>179.0</td>
      <td>-92.0</td>
      <td>1</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>5.0</td>
      <td>1</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>169.0</td>
      <td>1989.0</td>
      <td>-52.0</td>
      <td>1</td>
      <td>2.0</td>
      <td>76.3</td>
      <td>76.3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>5.0</td>
      <td>0</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>Pass</td>
      <td>1</td>
      <td>295.0</td>
      <td>739.0</td>
      <td>-176.0</td>
      <td>1</td>
      <td>-11.4</td>
      <td>55.0</td>
      <td>55.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[61]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdf</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 32589 entries, 0 to 32588
Data columns (total 36 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   region_East Anglian Region   32589 non-null  uint8  
 1   region_East Midlands Region  32589 non-null  uint8  
 2   region_Ireland               32589 non-null  uint8  
 3   region_London Region         32589 non-null  uint8  
 4   region_North Region          32589 non-null  uint8  
 5   region_North Western Region  32589 non-null  uint8  
 6   region_Scotland              32589 non-null  uint8  
 7   region_South East Region     32589 non-null  uint8  
 8   region_South Region          32589 non-null  uint8  
 9   region_South West Region     32589 non-null  uint8  
 10  region_Wales                 32589 non-null  uint8  
 11  region_West Midlands Region  32589 non-null  uint8  
 12  region_Yorkshire Region      32589 non-null  uint8  
 13  code_module_AAA              32589 non-null  uint8  
 14  code_module_BBB              32589 non-null  uint8  
 15  code_module_CCC              32589 non-null  uint8  
 16  code_module_DDD              32589 non-null  uint8  
 17  code_module_EEE              32589 non-null  uint8  
 18  code_module_FFF              32589 non-null  uint8  
 19  code_module_GGG              32589 non-null  uint8  
 20  highest_education            32589 non-null  int64  
 21  imd_band                     31478 non-null  float64
 22  age_band                     32589 non-null  int64  
 23  num_of_prev_attempts         32589 non-null  int64  
 24  studied_credits              32589 non-null  int64  
 25  disability                   32589 non-null  int32  
 26  final_result                 32589 non-null  object 
 27  gender_F                     32589 non-null  int32  
 28  vle_before                   29225 non-null  float64
 29  vle_after                    29225 non-null  float64
 30  date_registration            32544 non-null  float64
 31  module_long                  32589 non-null  int32  
 32  date_submit_advance          25839 non-null  float64
 33  counted_score_weighted       32589 non-null  float64
 34  av_cscore                    32589 non-null  float64
 35  withdrawn                    32589 non-null  int32  
dtypes: float64(7), int32(4), int64(4), object(1), uint8(20)
memory usage: 4.1+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that the dataset has a basic structure, we find there are several columns with missing data.</p>
<ol>
<li>Roughly a quarter of the data has missing values in at least one column. We will need to impute values for imd_band, as there is clearly missing data here - every student must belong to an imd_band.</li>
<li>Similarly, we cannot assume the Student VLE dataset is complete, as vle_before and vle_after have the same missing values - these will be imputed also.</li>
<li>Date_registration must have a value, but is missing in 45 records. These records contain a lot of missing information, and appear to be mostly students that have withdrawn without submitting any work, possibly before the course has even started. As a tiny fraction of the dataset, these records will be removed going forward.</li>
<li>The date_submit_advance missing values correspond almost entirely to students who have Withdrawn or Failed. It would make sense to set this column to 0 for these records, indicating that at the hand-in date, no work was submitted. There are only 2 records in the dataset remaining where students have passed without submitting any work or exam. Either this data is missing also or these students were Passed based on extenuating circumstances - either way, they are anomalies, and will be removed from the dataset.</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Identify rows with missing data</span>
<span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="c1"># Look at the rows missings values in the vle before and after columns</span>
<span class="n">sdf</span><span class="p">[(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;vle_before&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;vle_after&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span>
<span class="c1"># Look at rows with date_registration missing</span>
<span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;date_registration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
<span class="c1"># Remove rows with missing date of registration</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;date_registration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>

<span class="c1"># Identify date_submit_advance missing values corresponding to students who have Withdrawn or Failed.</span>
<span class="n">sdf</span><span class="p">[(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;date_submit_advance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;final_result&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Fail&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;final_result&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Withdrawn&#39;</span><span class="p">)]</span>
<span class="c1"># Set this column to 0 for these records, and drop the anomalies</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">sdf</span><span class="p">[(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;date_submit_advance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;final_result&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Fail&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;final_result&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Withdrawn&#39;</span><span class="p">)]</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;date_submit_advance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;date_submit_advance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;date_submit_advance&#39;</span><span class="p">])</span>
<span class="c1"># The final result column can now be dropped from the dataset</span>
<span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;final_result&#39;</span><span class="p">)</span>
<span class="n">sdf</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 32542 entries, 0 to 32588
Data columns (total 35 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   region_East Anglian Region   32542 non-null  uint8  
 1   region_East Midlands Region  32542 non-null  uint8  
 2   region_Ireland               32542 non-null  uint8  
 3   region_London Region         32542 non-null  uint8  
 4   region_North Region          32542 non-null  uint8  
 5   region_North Western Region  32542 non-null  uint8  
 6   region_Scotland              32542 non-null  uint8  
 7   region_South East Region     32542 non-null  uint8  
 8   region_South Region          32542 non-null  uint8  
 9   region_South West Region     32542 non-null  uint8  
 10  region_Wales                 32542 non-null  uint8  
 11  region_West Midlands Region  32542 non-null  uint8  
 12  region_Yorkshire Region      32542 non-null  uint8  
 13  code_module_AAA              32542 non-null  uint8  
 14  code_module_BBB              32542 non-null  uint8  
 15  code_module_CCC              32542 non-null  uint8  
 16  code_module_DDD              32542 non-null  uint8  
 17  code_module_EEE              32542 non-null  uint8  
 18  code_module_FFF              32542 non-null  uint8  
 19  code_module_GGG              32542 non-null  uint8  
 20  highest_education            32542 non-null  int64  
 21  imd_band                     31431 non-null  float64
 22  age_band                     32542 non-null  int64  
 23  num_of_prev_attempts         32542 non-null  int64  
 24  studied_credits              32542 non-null  int64  
 25  disability                   32542 non-null  int32  
 26  gender_F                     32542 non-null  int32  
 27  vle_before                   29216 non-null  float64
 28  vle_after                    29216 non-null  float64
 29  date_registration            32542 non-null  float64
 30  module_long                  32542 non-null  int32  
 31  date_submit_advance          32542 non-null  float64
 32  counted_score_weighted       32542 non-null  float64
 33  av_cscore                    32542 non-null  float64
 34  withdrawn                    32542 non-null  int32  
dtypes: float64(7), int32(4), int64(4), uint8(20)
memory usage: 4.1 MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Splitting,-Transforming,-Imputing,-Oversampling">Splitting, Transforming, Imputing, Oversampling<a class="anchor-link" href="#Splitting,-Transforming,-Imputing,-Oversampling">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before any imputation is made for any remaining missing values, it is worth splitting the data into train and test sets. This allows us to see how adaptable any models will be to new data, even if they have missing values themselves. All operations to this point got the dataset in a workable format, but it must be split now to prevent any inference of the test set data on the training set data.
There are ultimately two targets being investigated using different methods as per the assignment:</p>
<ul>
<li>A regression approach will target 'av_cscore', to predict which students will fail (av_cscore &lt;40)</li>
<li>A classification approach will target 'withdrawn', to predict which students will withdraw (withdrawn = 1)
As such, the datasets used in each case will vary slightly, and these will be labelled r and c as appropriate.</li>
</ul>
<p>The regression data set excludes all records where students have withdrawn. This is because we are predicting whether a student will fail, and students withdrawing from the module will skew these results downwards. In other words, we cannot say whether a student would have failed had they not withdrawn.
For regression, counted_score_weighted is excluded as a column as this will be very highly correlated to av_cscore (our target), particularly where students didn't withdraw - the only purpose of this column is to help with predicting withdrawals, i.e. not for this task.
For classification, the av_cscore is not used as counted_score_weighted gives a better impression of a student's marks before dropping out whilst also being relevant to students that didn't drop out - this is due to its weighting being only by the coursework that was completed prior to dropping out.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[63]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="c1"># Create the regression dataset</span>
<span class="n">regData</span> <span class="o">=</span> <span class="n">sdf</span><span class="p">[</span><span class="n">sdf</span><span class="p">[</span><span class="s1">&#39;withdrawn&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Split the regression data</span>
<span class="n">Xr_train</span><span class="p">,</span> <span class="n">Xr_test</span><span class="p">,</span> <span class="n">yr_train</span><span class="p">,</span> <span class="n">yr_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">regData</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">32</span><span class="p">],</span><span class="n">regData</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">33</span><span class="p">],</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">618</span><span class="p">)</span>
<span class="c1"># Split the classification data</span>
<span class="n">Xc_train</span><span class="p">,</span> <span class="n">Xc_test</span><span class="p">,</span> <span class="n">yc_train</span><span class="p">,</span> <span class="n">yc_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">sdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">33</span><span class="p">],</span><span class="n">sdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">34</span><span class="p">],</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">618</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># View the training data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Xr_train</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Xc_train</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 16818 entries, 21500 to 2078
Data columns (total 32 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   region_East Anglian Region   16818 non-null  uint8  
 1   region_East Midlands Region  16818 non-null  uint8  
 2   region_Ireland               16818 non-null  uint8  
 3   region_London Region         16818 non-null  uint8  
 4   region_North Region          16818 non-null  uint8  
 5   region_North Western Region  16818 non-null  uint8  
 6   region_Scotland              16818 non-null  uint8  
 7   region_South East Region     16818 non-null  uint8  
 8   region_South Region          16818 non-null  uint8  
 9   region_South West Region     16818 non-null  uint8  
 10  region_Wales                 16818 non-null  uint8  
 11  region_West Midlands Region  16818 non-null  uint8  
 12  region_Yorkshire Region      16818 non-null  uint8  
 13  code_module_AAA              16818 non-null  uint8  
 14  code_module_BBB              16818 non-null  uint8  
 15  code_module_CCC              16818 non-null  uint8  
 16  code_module_DDD              16818 non-null  uint8  
 17  code_module_EEE              16818 non-null  uint8  
 18  code_module_FFF              16818 non-null  uint8  
 19  code_module_GGG              16818 non-null  uint8  
 20  highest_education            16818 non-null  int64  
 21  imd_band                     16165 non-null  float64
 22  age_band                     16818 non-null  int64  
 23  num_of_prev_attempts         16818 non-null  int64  
 24  studied_credits              16818 non-null  int64  
 25  disability                   16818 non-null  int32  
 26  gender_F                     16818 non-null  int32  
 27  vle_before                   16533 non-null  float64
 28  vle_after                    16533 non-null  float64
 29  date_registration            16818 non-null  float64
 30  module_long                  16818 non-null  int32  
 31  date_submit_advance          16818 non-null  float64
dtypes: float64(5), int32(3), int64(4), uint8(20)
memory usage: 1.8 MB
None


&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 24406 entries, 26863 to 1568
Data columns (total 33 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   region_East Anglian Region   24406 non-null  uint8  
 1   region_East Midlands Region  24406 non-null  uint8  
 2   region_Ireland               24406 non-null  uint8  
 3   region_London Region         24406 non-null  uint8  
 4   region_North Region          24406 non-null  uint8  
 5   region_North Western Region  24406 non-null  uint8  
 6   region_Scotland              24406 non-null  uint8  
 7   region_South East Region     24406 non-null  uint8  
 8   region_South Region          24406 non-null  uint8  
 9   region_South West Region     24406 non-null  uint8  
 10  region_Wales                 24406 non-null  uint8  
 11  region_West Midlands Region  24406 non-null  uint8  
 12  region_Yorkshire Region      24406 non-null  uint8  
 13  code_module_AAA              24406 non-null  uint8  
 14  code_module_BBB              24406 non-null  uint8  
 15  code_module_CCC              24406 non-null  uint8  
 16  code_module_DDD              24406 non-null  uint8  
 17  code_module_EEE              24406 non-null  uint8  
 18  code_module_FFF              24406 non-null  uint8  
 19  code_module_GGG              24406 non-null  uint8  
 20  highest_education            24406 non-null  int64  
 21  imd_band                     23560 non-null  float64
 22  age_band                     24406 non-null  int64  
 23  num_of_prev_attempts         24406 non-null  int64  
 24  studied_credits              24406 non-null  int64  
 25  disability                   24406 non-null  int32  
 26  gender_F                     24406 non-null  int32  
 27  vle_before                   21874 non-null  float64
 28  vle_after                    21874 non-null  float64
 29  date_registration            24406 non-null  float64
 30  module_long                  24406 non-null  int32  
 31  date_submit_advance          24406 non-null  float64
 32  counted_score_weighted       24406 non-null  float64
dtypes: float64(6), int32(3), int64(4), uint8(20)
memory usage: 2.8 MB
None
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The 2 datasets for regression and classification are very similar, with an extra column (counted_score_weighted) present in the classification set, as well as more rows of data. Any methods to modify one dataset will therefore also be applied to the other where appropriate.
It is worth examining the data for correlations between variables, as these may need to be combined if correlated.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[65]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Temporarily remove missing values from dataset to allow plotting of correlation matrix</span>
<span class="n">Xrm</span> <span class="o">=</span> <span class="n">Xc_train</span><span class="p">[</span><span class="n">Xc_train</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
<span class="n">yrm</span> <span class="o">=</span> <span class="n">yc_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Xrm</span><span class="o">.</span><span class="n">index</span><span class="p">,]</span><span class="o">.</span><span class="n">values</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-dark&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">Xrm</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">31</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="n">yrm</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;brg&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Scatter Matrix of Continuous Features&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="output_102_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There is no obvious pairwise correlation evident with the continuous data shown, but there is some skew present in the histograms. Colouring by withdrawn status also allows visualisation of separation between the classes here, which is not particularly apparent. Correlations are further investigated with a heatmap (code adapted from towardsdatascience.com/data-transformation-e7b3b4268151).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[66]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Build heatmap from correlation matrix</span>
<span class="n">corr_features</span> <span class="o">=</span> <span class="n">Xrm</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span><span class="n">corr_features</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;vlag&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">a</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Correlation Heatmap of All Features&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">ax_col_dendrogram</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="output_104_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There is some stronger correlation between some features, mostly with use of the virtual learning environment. Most notably, this correlates positively with the score achieved by students. The modelling will help to determine whether this persists as a noticeable predictor in regression.
It is beneficial for later modelling to normalise the data. This centres and scales each feature to have unit variance and mean of zero. This is useful to avoid the scale of a feature disproportionately influencing a model due its scale, which is a particular concern when using models like kNN where distance plays a key role.
As there is some skew present in the data, the PowerTransformer is used to both normalise and coerce the features to a Gaussian distribution - whilst this is not essential, doing so typically improves model performance where skew is present in the data. The yeo-johnson method is chosen as the dataset contains some negative data, making it unsuitable for the box-cox method. (<a href="https://scikit-learn.org/stable/modules/preprocessing.html#non-linear-transformation">https://scikit-learn.org/stable/modules/preprocessing.html#non-linear-transformation</a>)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[67]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Transform features data</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PowerTransformer</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">PowerTransformer</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;yeo-johnson&#39;</span><span class="p">)</span>
<span class="n">Xc_train_trans</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">Xc_train</span><span class="p">)</span>
<span class="n">Xc_test_trans</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">Xc_test</span><span class="p">)</span>
<span class="n">Xr_train_trans</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">Xr_train</span><span class="p">)</span>
<span class="n">Xr_test_trans</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">Xr_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note: This transformation has to be performed on the test set also to get to a similar scale - the transform function will not be identical to both the training and test sets, but with enough data in each and random sampling they should be similar. This is not performed prior to splitting to avoid the test data influencing the training data or vice versa.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There is an issue of missing values in the X datasets. We have no idea as to the actual values for imd_band or vle use, but we do know that rows with missing values make up &lt;12.5% of the dataset.
kNN imputation is generally effective as an imputer, and has better adaption to a dataset than a simple central measurement imputer (<a href="https://machinelearningmastery.com/knn-imputation-for-missing-values-in-machine-learning/">https://machinelearningmastery.com/knn-imputation-for-missing-values-in-machine-learning/</a>). For now, the imputer parameters will be set somewhat arbitrarily just to help with EDA, but this will be modified later.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[68]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Impute values</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Xc_train_imp</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">Xc_train_trans</span><span class="p">)</span>
<span class="n">Xc_train_cols</span> <span class="o">=</span> <span class="n">Xc_train</span><span class="o">.</span><span class="n">columns</span>
<span class="n">Xr_train_imp</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">Xr_train_trans</span><span class="p">)</span>
<span class="n">Xr_train_cols</span> <span class="o">=</span> <span class="n">Xr_train</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Looking at the imputed dataset, we can see that there are no more missing values</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[69]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Xc_train_imp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Xc_train_imp</span><span class="p">)</span>
<span class="n">Xc_train_imp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">Xc_train_cols</span>
<span class="n">Xr_train_imp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Xr_train_imp</span><span class="p">)</span>
<span class="n">Xr_train_imp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">Xr_train_cols</span>
<span class="n">Xc_train_imp</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 24406 entries, 0 to 24405
Data columns (total 33 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   region_East Anglian Region   24406 non-null  float64
 1   region_East Midlands Region  24406 non-null  float64
 2   region_Ireland               24406 non-null  float64
 3   region_London Region         24406 non-null  float64
 4   region_North Region          24406 non-null  float64
 5   region_North Western Region  24406 non-null  float64
 6   region_Scotland              24406 non-null  float64
 7   region_South East Region     24406 non-null  float64
 8   region_South Region          24406 non-null  float64
 9   region_South West Region     24406 non-null  float64
 10  region_Wales                 24406 non-null  float64
 11  region_West Midlands Region  24406 non-null  float64
 12  region_Yorkshire Region      24406 non-null  float64
 13  code_module_AAA              24406 non-null  float64
 14  code_module_BBB              24406 non-null  float64
 15  code_module_CCC              24406 non-null  float64
 16  code_module_DDD              24406 non-null  float64
 17  code_module_EEE              24406 non-null  float64
 18  code_module_FFF              24406 non-null  float64
 19  code_module_GGG              24406 non-null  float64
 20  highest_education            24406 non-null  float64
 21  imd_band                     24406 non-null  float64
 22  age_band                     24406 non-null  float64
 23  num_of_prev_attempts         24406 non-null  float64
 24  studied_credits              24406 non-null  float64
 25  disability                   24406 non-null  float64
 26  gender_F                     24406 non-null  float64
 27  vle_before                   24406 non-null  float64
 28  vle_after                    24406 non-null  float64
 29  date_registration            24406 non-null  float64
 30  module_long                  24406 non-null  float64
 31  date_submit_advance          24406 non-null  float64
 32  counted_score_weighted       24406 non-null  float64
dtypes: float64(33)
memory usage: 6.1 MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Looking at the target (positive) class for classification, we notice an imbalance of data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[70]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Create target variable histogram</span>
<span class="n">yc_train</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Target variable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram showing the distribution of the target variable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="output_113_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Whilst this kind of target imbalance is not uncommon, this can later affect the performance metrics of prediction models, particularly where the minor class is also the positive class.
There are several options for dealing with this issue. Under-sampling would involve removing data of the major class until the classes balance. This would involve removing about 1/3 of our dataset, and as it is not very large here, this is not a good option. Oversampling would involve duplicating (resampling) data in the positive class. This is a good option here, but combining this with synthetic sampling would make this even more effective. This adds randomness into the over-sampled data to produce similar but not identical data for the minority class. The SMOTE method is used here to achieve this, giving 33540 rows from the original 24406.(<a href="https://machinelearningmastery.com/tactics-to-combat-imbalanced-classes-in-your-machine-learning-dataset/">https://machinelearningmastery.com/tactics-to-combat-imbalanced-classes-in-your-machine-learning-dataset/</a>)
Code adapted from <a href="https://machinelearningmastery.com/smote-oversampling-for-imbalanced-classification/">https://machinelearningmastery.com/smote-oversampling-for-imbalanced-classification/</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[291]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Execute SMOTE and plot new target histogram</span>
<span class="c1">#!pip install imblearn</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="n">oversample</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">314</span><span class="p">)</span>
<span class="n">Xc_trainOS</span><span class="p">,</span><span class="n">yc_trainOS</span> <span class="o">=</span> <span class="n">oversample</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">Xc_train_imp</span><span class="p">,</span><span class="n">yc_train</span><span class="p">)</span>
<span class="n">Xc_trainOS</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">yc_trainOS</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Target variable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram showing the distribution of the oversampled target variable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 33540 entries, 0 to 33539
Data columns (total 33 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   region_East Anglian Region   33540 non-null  float64
 1   region_East Midlands Region  33540 non-null  float64
 2   region_Ireland               33540 non-null  float64
 3   region_London Region         33540 non-null  float64
 4   region_North Region          33540 non-null  float64
 5   region_North Western Region  33540 non-null  float64
 6   region_Scotland              33540 non-null  float64
 7   region_South East Region     33540 non-null  float64
 8   region_South Region          33540 non-null  float64
 9   region_South West Region     33540 non-null  float64
 10  region_Wales                 33540 non-null  float64
 11  region_West Midlands Region  33540 non-null  float64
 12  region_Yorkshire Region      33540 non-null  float64
 13  code_module_AAA              33540 non-null  float64
 14  code_module_BBB              33540 non-null  float64
 15  code_module_CCC              33540 non-null  float64
 16  code_module_DDD              33540 non-null  float64
 17  code_module_EEE              33540 non-null  float64
 18  code_module_FFF              33540 non-null  float64
 19  code_module_GGG              33540 non-null  float64
 20  highest_education            33540 non-null  float64
 21  imd_band                     33540 non-null  float64
 22  age_band                     33540 non-null  float64
 23  num_of_prev_attempts         33540 non-null  float64
 24  studied_credits              33540 non-null  float64
 25  disability                   33540 non-null  float64
 26  gender_F                     33540 non-null  float64
 27  vle_before                   33540 non-null  float64
 28  vle_after                    33540 non-null  float64
 29  date_registration            33540 non-null  float64
 30  module_long                  33540 non-null  float64
 31  date_submit_advance          33540 non-null  float64
 32  counted_score_weighted       33540 non-null  float64
dtypes: float64(33)
memory usage: 8.4 MB
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="output_115_1.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Modelling-with-Pipelines">Modelling with Pipelines<a class="anchor-link" href="#Modelling-with-Pipelines">&#182;</a></h1><p>There is now a class-balanced version of the classification training dataset and both datasets are free of missing values. Several operations have been performed on the data since splitting, providing different variables to now work with in modelling. This process is summarised below:</p>
<ul>
<li>Regression set (predicting scores): traintestsplit - PowerTransformer - KNNImputer - Xr_train_imp &amp; yr_train</li>
<li>Classification set (predicting withdrawals): traintestsplit - PowerTransformer - KNNImputer - SMOTE - Xc_trainOS &amp; yc_trainOS
These operations can be put into a pipeline to allow automation of hyperparameter tuning. As there are no parameters of the PowerTransformer that need tuning, the pipeline will commence after this step to avoid wasteful computation through repetition.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Classification">Classification<a class="anchor-link" href="#Classification">&#182;</a></h2><h3 id="kNN">kNN<a class="anchor-link" href="#kNN">&#182;</a></h3><p>To demonstrate the process going forward and establish a baseline for modelling and assessment, a simple KNN prediction model is built for classification.
To avoid overfitting of the models to the training data when tuning hyperparameters, k-fold cross-validation is used. Here, a grid-based cross-validation approach is used, which tests all values of all hyperparameters specified to find the best model based on its recall score.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[90]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">recall_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="c1"># Specify steps of pipeline</span>
<span class="n">c_steps</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;impute&#39;</span><span class="p">,</span> <span class="n">KNNImputer</span><span class="p">()),</span>
           <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">314</span><span class="p">)),</span>
           <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">KNeighborsClassifier</span><span class="p">())]</span>
<span class="c1"># Construct the pipeline</span>
<span class="n">c_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">c_steps</span><span class="p">)</span>
<span class="c1"># Decide ranges of parameters to use</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;impute__n_neighbors&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
    <span class="s1">&#39;knn__n_neighbors&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1"># Set up cross-validation of the pipeline (5-fold chosen, and n_jobs allows parallel processing)</span>
<span class="n">knn_cv</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">c_pipe</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">)</span>
<span class="c1"># Fit GridSearch object to the training data</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">knn_cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xc_train_trans</span><span class="p">,</span> <span class="n">yc_train</span><span class="p">)</span>
<span class="c1"># Use model to assess fit on the training set and predict on the test set</span>
<span class="n">yc_pred_train</span> <span class="o">=</span> <span class="n">knn_cv</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xc_train_trans</span><span class="p">)</span>
<span class="n">yc_pred</span> <span class="o">=</span> <span class="n">knn_cv</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xc_test_trans</span><span class="p">)</span>
<span class="c1"># Show recall figure of prediction model and predictions from training set</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training set recall score of knn classifier: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall_score</span><span class="p">(</span><span class="n">yc_train</span><span class="p">,</span> <span class="n">yc_pred_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test set recall score of knn classifier: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall_score</span><span class="p">(</span><span class="n">yc_test</span><span class="p">,</span> <span class="n">yc_pred</span><span class="p">)))</span>
<span class="c1"># We can see the optimal hyperparameters for the model, and adjust the grid parameter ranges for re-running if appropriate.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;kNN best hyperparameters: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">knn_cv</span><span class="o">.</span><span class="n">best_params_</span><span class="p">))</span>
<span class="c1"># Looking at the confusion matrix for the model, we can observe how well it predicted over the test set</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Confusion matrix:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">yc_test</span><span class="p">,</span> <span class="n">yc_pred</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Training set recall score of knn classifier: 0.89
Test set recall score of knn classifier: 0.71
kNN best hyperparameters: {&#39;impute__n_neighbors&#39;: 9, &#39;knn__n_neighbors&#39;: 5}
Confusion matrix:
 [[4364 1291]
 [ 724 1757]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I interpret the goal of the modelling here as being a tool to enable the Open University to see where to dedicate resources to limit the number of students dropping out. At the same time, they do not want to waste any additional resources on students that are not likely to drop out. On balance, it is probably more important to limit the number of students falsely identified as not likely to withdraw. In other words, there is a high cost of false negatives, which is why the 'recall' metric is used. (<a href="https://towardsdatascience.com/accuracy-precision-recall-or-f1-331fb37c5cb9">https://towardsdatascience.com/accuracy-precision-recall-or-f1-331fb37c5cb9</a>). The recall score looks at True Positives / (True Positives + False Negatives). The confusion matrix shows that of the 2481 students who withdrew in the test set, 1757 were correctly predicted as withdrawers, and 724 were incorrectly predicted as non-withdrawers. Similarly, of those who didn't withdraw, 4364 were correctly predicted as non-withdrawers and 1291 were incorrectly predicted as withdrawers.
The test set score  for the kNN model is not very good, and we can see from the training score that this may be due to overfitting (much higher than the test score). However, there is not much more model adjustment available for the kNN classifier, so a different model will be tried.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tree-Ensemble">Tree Ensemble<a class="anchor-link" href="#Tree-Ensemble">&#182;</a></h3><p>As a potential improvement to the kNN classifier results, a tree ensemble classifier is built. The GradientBoostingClassifier uses strong pre-pruning via many very shallow tree models (depth controlled here by max_depth), each of which provides poor prediction but tries to correct the mistakes of previous trees, the extent of which is controlled here by the learning_rate.
As the number of parameters have increased, RandomizedSearchCV is used instead of GridSearchCV, limiting the combinations of parameters and therefore the number of models tested to improve computation time.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[135]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>

<span class="c1"># Specify steps of pipeline</span>
<span class="n">c_steps</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;impute&#39;</span><span class="p">,</span> <span class="n">KNNImputer</span><span class="p">()),</span>
           <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">314</span><span class="p">)),</span>
           <span class="p">(</span><span class="s1">&#39;gbc&#39;</span><span class="p">,</span> <span class="n">GradientBoostingClassifier</span><span class="p">())]</span>
<span class="c1"># Construct the pipeline</span>
<span class="n">c_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">c_steps</span><span class="p">)</span>
<span class="c1"># Decide ranges of parameters to use</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;impute__n_neighbors&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;gbc__learning_rate&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;gbc__max_depth&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1"># Set up cross-validation of the pipeline (n_iter adjusts the number of parameter settings sampled)</span>
<span class="n">gbc_cv</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">c_pipe</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">628</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">)</span>
<span class="c1"># Fit Search object to the training data</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">gbc_cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xc_train_trans</span><span class="p">,</span> <span class="n">yc_train</span><span class="p">)</span>

<span class="c1"># Use model to assess fit on the training set and predict on the test set</span>
<span class="n">yc_pred_train</span> <span class="o">=</span> <span class="n">gbc_cv</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xc_train_trans</span><span class="p">)</span>
<span class="n">yc_pred</span> <span class="o">=</span> <span class="n">gbc_cv</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xc_test_trans</span><span class="p">)</span>
<span class="c1"># Show statistics of modelling</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training set recall score of gradient boosting classifier: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall_score</span><span class="p">(</span><span class="n">yc_train</span><span class="p">,</span> <span class="n">yc_pred_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test set recall score of gradient boosting classifier: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall_score</span><span class="p">(</span><span class="n">yc_test</span><span class="p">,</span> <span class="n">yc_pred</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gradient boosting best hyperparameters: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gbc_cv</span><span class="o">.</span><span class="n">best_params_</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Confusion matrix:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">yc_test</span><span class="p">,</span> <span class="n">yc_pred</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Training set recall score of gradient boosting classifier: 0.78
Test set recall score of gradient boosting classifier: 0.77
Gradient boosting best hyperparameters: {&#39;impute__n_neighbors&#39;: 3, &#39;gbc__max_depth&#39;: 2, &#39;gbc__learning_rate&#39;: 0.005}
Confusion matrix:
 [[4131 1524]
 [ 570 1911]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The tree ensemble method has increased the recall score to 77%, which is a good improvement on the kNN model. Importantly, the training set score with this model does not suggest there has been overfitting, as the scores are higher and similar. There is even a possible chance of underfitting here caused by the low max_depth and learning_rate, which both came out at the lower limit of the range provided, but should not really be pushed any lower on this model for risk of increased underfitting. ('Introduction to Machine Learning with Python' - Muller &amp; Guido, 2018).
Compared with the kNN model, this model has now identified ~400 more students as potential withdrawers, but of these only ~150 are correctly identified in this category (NB: these are not necessarily the exact same students as with the kNN classifier). Depending on the university's opinion this could be more useful or may not be an improvement at all, depending on the costs associated with additional student support versus the loss associated with a student withdrawing. This highlights an issue with using the recall score instead of e.g. accuracy.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Linear-Model---ElasticNet">Linear Model - ElasticNet<a class="anchor-link" href="#Linear-Model---ElasticNet">&#182;</a></h3><p>To try to improve further on the metrics of the gradient boosted tree classifier, a linear model is built. The ElasticNet model is a logistic regression that uses both L1 and L2 regularisation (the ratio of which is controlled by l1_ratio, and the degree of regularisation controlled by C) allowing reduction and elimination of unnecessary features - this can help to guide the Open University in allocating resources to those students most likely to withdraw.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[110]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="c1"># Specify steps of pipeline</span>
<span class="n">c_steps</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;impute&#39;</span><span class="p">,</span> <span class="n">KNNImputer</span><span class="p">()),</span>
           <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">314</span><span class="p">)),</span>
           <span class="p">(</span><span class="s1">&#39;logreg&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span> <span class="o">=</span> <span class="s1">&#39;elasticnet&#39;</span><span class="p">,</span> <span class="n">solver</span> <span class="o">=</span> <span class="s1">&#39;saga&#39;</span><span class="p">))]</span>
<span class="c1"># Construct the pipeline</span>
<span class="n">c_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">c_steps</span><span class="p">)</span>
<span class="c1"># Decide ranges of parameters to use</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;impute__n_neighbors&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span>
    <span class="s1">&#39;logreg__l1_ratio&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="c1"># This determines the ratio of l1 and l2 regularisation</span>
    <span class="s1">&#39;logreg__C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># This dictates the amount of regularisation to apply</span>
<span class="p">}</span>
<span class="c1"># Set up cross-validation of the pipeline</span>
<span class="n">logreg_cv</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">c_pipe</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">142</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">)</span>
<span class="c1"># Fit Search object to the training data</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">logreg_cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xc_train_trans</span><span class="p">,</span> <span class="n">yc_train</span><span class="p">)</span>

<span class="c1"># Use model to assess fit on the training set and predict on the test set</span>
<span class="n">yc_pred_train</span> <span class="o">=</span> <span class="n">logreg_cv</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xc_train_trans</span><span class="p">)</span>
<span class="n">yc_pred</span> <span class="o">=</span> <span class="n">logreg_cv</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xc_test_trans</span><span class="p">)</span>
<span class="c1"># Show statistics of modelling</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training set recall score of logistic regression classifier: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall_score</span><span class="p">(</span><span class="n">yc_train</span><span class="p">,</span> <span class="n">yc_pred_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test set recall score of logistic regression classifier: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall_score</span><span class="p">(</span><span class="n">yc_test</span><span class="p">,</span> <span class="n">yc_pred</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logistic regression best hyperparameters: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logreg_cv</span><span class="o">.</span><span class="n">best_params_</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Confusion matrix:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">yc_test</span><span class="p">,</span> <span class="n">yc_pred</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Training set recall score of logistic regression classifier: 0.77
Test set recall score of logistic regression classifier: 0.77
Logistic regression best hyperparameters: {&#39;logreg__l1_ratio&#39;: 0.034482758620689655, &#39;logreg__C&#39;: 10.0, &#39;impute__n_neighbors&#39;: 7}
Confusion matrix:
 [[4777  878]
 [ 583 1898]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This model has given a similar recall score as the previous model at 77% recall. Compared with the tree ensemble model, we see far fewer false positives (1524 to 878) with roughly the same false negatives number (570 to 583) and those correctly classed as 'Withdraw' (1911 to 1898). This model appear to be optimal for the data and the most useful for the university.
In addition, as the logistic regression used regularisation (the low l1_ratio indicates mostly l2 regularisation, and a high C means less regularisation overall) and the data was normalised, we can use this model to see the relative importance of each of the features on withdrawal rates.</p>
<h3 id="Key-Feature-Identification">Key Feature Identification<a class="anchor-link" href="#Key-Feature-Identification">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[120]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Firstly, the optimal model from the previous step is run</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">Xc_train_imp</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">Xc_train_trans</span><span class="p">)</span>
<span class="n">Xc_train_cols</span> <span class="o">=</span> <span class="n">Xc_train</span><span class="o">.</span><span class="n">columns</span>
<span class="n">oversample</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">314</span><span class="p">)</span>
<span class="n">Xc_trainOS</span><span class="p">,</span><span class="n">yc_trainOS</span> <span class="o">=</span> <span class="n">oversample</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">Xc_train_imp</span><span class="p">,</span><span class="n">yc_train</span><span class="p">)</span>

<span class="n">logreg_best</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">l1_ratio</span><span class="o">=</span><span class="mf">0.034482758620689655</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;elasticnet&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;saga&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">logreg_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xc_trainOS</span><span class="p">,</span> <span class="n">yc_trainOS</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[136]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
<span class="c1"># The coefficients of each feature indicate their relative importance to withdrawal rates</span>
<span class="n">coef_list</span><span class="o">=</span><span class="n">logreg_best</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Features&#39;</span><span class="p">:</span><span class="n">Xc_train_cols</span><span class="p">,</span> <span class="s1">&#39;Coefficients&#39;</span><span class="p">:</span><span class="n">coef_list</span><span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Abs_Coefficients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Coefficients&#39;</span><span class="p">])</span>
<span class="c1"># Remove less important features</span>
<span class="c1">#df_full = df.copy()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Abs_Coefficients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.15</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;posneg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Coefficients&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Abs_Coefficients&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Features&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Abs_Coefficients&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;posneg&#39;</span><span class="p">],</span> <span class="n">rot</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Features&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Logistic Regression Coefficient (Absolute)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Chart showing the features contributing most to withdrawal rates&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">leg_neg</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Increased Withdrawal Rate&#39;</span><span class="p">)</span>
<span class="n">leg_pos</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reduced Withdrawal Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">leg_pos</span><span class="p">,</span> <span class="n">leg_neg</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="output_127_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Statistical-Confirmation">Statistical Confirmation<a class="anchor-link" href="#Statistical-Confirmation">&#182;</a></h4><p>To ensure that the variables shown have sufficient statistical significance, a logit model is run separately. Whilst this does not have the regularisation parameters of ElasticNet (which should already account for insignificance of variables by applying low coefficients), it should serve as a confirmation of the findings.
The initial model contained several multicolinear variables and many p-values above the significance level of 0.05. Insignificant variables are removed one at a time to produce the model observed below.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[98]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="n">Xc_trainOS_col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Xc_trainOS</span><span class="p">)</span>
<span class="n">Xc_trainOS_col</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">Xc_train_cols</span>
<span class="c1">#logit=sm.Logit(yc_trainOS,Xc_trainOS_col)</span>
<span class="c1">#result=logit.fit()</span>
<span class="c1">#print(result.summary2())</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;region_East Midlands Region&#39;</span><span class="p">,</span>
       <span class="s1">&#39;region_South Region&#39;</span><span class="p">,</span>
       <span class="s1">&#39;region_Wales&#39;</span><span class="p">,</span>
       <span class="s1">&#39;region_West Midlands Region&#39;</span><span class="p">,</span> 
       <span class="s1">&#39;code_module_BBB&#39;</span><span class="p">,</span> <span class="s1">&#39;code_module_CCC&#39;</span><span class="p">,</span>
       <span class="s1">&#39;code_module_EEE&#39;</span><span class="p">,</span> <span class="s1">&#39;code_module_FFF&#39;</span><span class="p">,</span>
       <span class="s1">&#39;code_module_GGG&#39;</span><span class="p">,</span> <span class="s1">&#39;highest_education&#39;</span><span class="p">,</span> <span class="s1">&#39;age_band&#39;</span><span class="p">,</span>
       <span class="s1">&#39;num_of_prev_attempts&#39;</span><span class="p">,</span> <span class="s1">&#39;studied_credits&#39;</span><span class="p">,</span> <span class="s1">&#39;disability&#39;</span><span class="p">,</span> <span class="s1">&#39;gender_F&#39;</span><span class="p">,</span>
       <span class="s1">&#39;vle_before&#39;</span><span class="p">,</span> <span class="s1">&#39;vle_after&#39;</span><span class="p">,</span> <span class="s1">&#39;date_registration&#39;</span><span class="p">,</span> 
       <span class="s1">&#39;date_submit_advance&#39;</span><span class="p">,</span> <span class="s1">&#39;counted_score_weighted&#39;</span><span class="p">]</span>
<span class="n">Xc_trainOS_col_rd</span> <span class="o">=</span> <span class="n">Xc_trainOS_col</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
<span class="n">logit</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">Logit</span><span class="p">(</span><span class="n">yc_trainOS</span><span class="p">,</span><span class="n">Xc_trainOS_col_rd</span><span class="p">)</span>
<span class="n">result</span><span class="o">=</span><span class="n">logit</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summary2</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Optimization terminated successfully.
         Current function value: 0.438654
         Iterations 7
                               Results: Logit
============================================================================
Model:                   Logit               Pseudo R-squared:    0.367     
Dependent Variable:      withdrawn           AIC:                 29464.9173
Date:                    2021-03-23 10:28    BIC:                 29633.3272
No. Observations:        33540               Log-Likelihood:      -14712.   
Df Model:                19                  LL-Null:             -23248.   
Df Residuals:            33520               LLR p-value:         0.0000    
Converged:               1.0000              Scale:               1.0000    
No. Iterations:          7.0000                                             
----------------------------------------------------------------------------
                             Coef.  Std.Err.    z     P&gt;|z|   [0.025  0.975]
----------------------------------------------------------------------------
region_East Midlands Region  0.0468   0.0146   3.2145 0.0013  0.0183  0.0754
region_South Region          0.0383   0.0144   2.6610 0.0078  0.0101  0.0666
region_Wales                -0.0681   0.0147  -4.6275 0.0000 -0.0970 -0.0393
region_West Midlands Region  0.0385   0.0146   2.6330 0.0085  0.0098  0.0671
code_module_BBB             -0.2898   0.0204 -14.1729 0.0000 -0.3299 -0.2497
code_module_CCC              0.2838   0.0173  16.3940 0.0000  0.2499  0.3177
code_module_EEE              0.0441   0.0181   2.4380 0.0148  0.0086  0.0795
code_module_FFF              0.3931   0.0208  18.8931 0.0000  0.3524  0.4339
code_module_GGG             -0.7599   0.0227 -33.4548 0.0000 -0.8044 -0.7153
highest_education           -0.0498   0.0154  -3.2208 0.0013 -0.0800 -0.0195
age_band                     0.1287   0.0152   8.4524 0.0000  0.0989  0.1586
num_of_prev_attempts        -0.1153   0.0149  -7.7425 0.0000 -0.1445 -0.0861
studied_credits              0.1915   0.0181  10.5588 0.0000  0.1560  0.2271
disability                   0.0979   0.0142   6.8834 0.0000  0.0700  0.1258
gender_F                     0.1471   0.0185   7.9440 0.0000  0.1108  0.1834
vle_before                   0.3824   0.0188  20.3125 0.0000  0.3455  0.4193
vle_after                   -1.2684   0.0250 -50.6574 0.0000 -1.3174 -1.2193
date_registration           -0.0940   0.0152  -6.1898 0.0000 -0.1238 -0.0642
date_submit_advance         -0.1173   0.0168  -6.9919 0.0000 -0.1502 -0.0844
counted_score_weighted      -1.0683   0.0231 -46.2135 0.0000 -1.1136 -1.0229
============================================================================

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We observe that the 20 (significant) variables remaining in the logistic regression model matched up with the top 20 most 'impactful' features of our prediction model.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># df_full = df_full.sort_values(&#39;Abs_Coefficients&#39;, ascending=False)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Outcomes">Outcomes<a class="anchor-link" href="#Outcomes">&#182;</a></h3><p>Aside from now having the ElasticNet model to help with predicting those students who may withdraw, we can see the impact of various features on withdrawals. Looking at the barchart, we can see that a student using the VLE a lot once the course has started, who is achieving good scores in coursework, and/or is on modules GGG or BBB is less likely to withdraw from the course. Conversely, students who are studying modules FFF or CCC, use the VLE more before the course starts (surprisingly), are studying more credits, and/or are female are more likely to withdraw. Some of these findings are intuitive, providing a sense check for the outcomes presented. These results provide useful direction for the university to focus their efforts to reduce withdrawal rates.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Classification-Model-Summary">Classification Model Summary<a class="anchor-link" href="#Classification-Model-Summary">&#182;</a></h3><table>
<thead><tr>
<th style="text-align:center">Statistics\Model</th>
<th style="text-align:center">kNN</th>
<th style="text-align:center">Tree Ensemble</th>
<th style="text-align:center">ElasticNet</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Training Recall Score</td>
<td style="text-align:center">0.89</td>
<td style="text-align:center">0.78</td>
<td style="text-align:center">0.77</td>
</tr>
<tr>
<td style="text-align:center">Test Recall Score</td>
<td style="text-align:center">0.71</td>
<td style="text-align:center">0.77</td>
<td style="text-align:center">0.77</td>
</tr>
<tr>
<td style="text-align:center">True Positives</td>
<td style="text-align:center">1757</td>
<td style="text-align:center">1911</td>
<td style="text-align:center">1898</td>
</tr>
<tr>
<td style="text-align:center">False Positives</td>
<td style="text-align:center">1291</td>
<td style="text-align:center">1524</td>
<td style="text-align:center">878</td>
</tr>
<tr>
<td style="text-align:center">True Negatives</td>
<td style="text-align:center">4364</td>
<td style="text-align:center">4131</td>
<td style="text-align:center">4777</td>
</tr>
<tr>
<td style="text-align:center">False Negatives</td>
<td style="text-align:center">724</td>
<td style="text-align:center">570</td>
<td style="text-align:center">583</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Regression">Regression<a class="anchor-link" href="#Regression">&#182;</a></h2><p>As previously mentioned, prediction of student failures will be made via regression on the average score variable, which is itself based on coursework scores and exam scores where relevant.
Linear models are particularly suited to this task. As logistic regression has only a classification algorithm, the regularised linear models Ridge and Lasso are used. These use L2 and L1 regularisation respectively, which should reduce overfitting compared to a standard linear model.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Ridge-Regression">Ridge Regression<a class="anchor-link" href="#Ridge-Regression">&#182;</a></h3><p>The Ridge model is built and run below. Whilst this data has been normalised already using PowerTransformer, the Ridge algorithm can also normalise to ensure there is no scale bias present.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[101]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="c1"># Specify steps of pipeline</span>
<span class="n">r_steps</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;impute&#39;</span><span class="p">,</span> <span class="n">KNNImputer</span><span class="p">()),</span>
           <span class="p">(</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))]</span>
<span class="c1"># Construct the pipeline</span>
<span class="n">r_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">r_steps</span><span class="p">)</span>
<span class="c1"># Decide ranges of parameters to use</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;impute__n_neighbors&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span>
    <span class="s1">&#39;ridge__alpha&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1"># Set up cross-validation of the pipeline</span>
<span class="n">ridge_cv</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">r_pipe</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">857</span><span class="p">)</span>
<span class="c1"># Fit Search object to the training data</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ridge_cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xr_train_trans</span><span class="p">,</span> <span class="n">yr_train</span><span class="p">)</span>

<span class="c1"># Use model to predict on the test set</span>
<span class="n">yr_pred</span> <span class="o">=</span> <span class="n">ridge_cv</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xr_test_trans</span><span class="p">)</span>
<span class="c1"># Show statistics of modelling</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R-squared score of ridge regression: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ridge_cv</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xr_test_trans</span><span class="p">,</span><span class="n">yr_test</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE of ridge regression: </span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">yr_test</span><span class="p">,</span><span class="n">yr_pred</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ridge regression best hyperparameters: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ridge_cv</span><span class="o">.</span><span class="n">best_params_</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>R-squared score of ridge regression: 0.64
MSE of ridge regression: 366
Ridge regression best hyperparameters: {&#39;ridge__alpha&#39;: 0.01, &#39;impute__n_neighbors&#39;: 6}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Ridge model gave an R-squared of 0.64, suggesting that the model explains 64% of the variance in the scores, with a mean squared error of 366. There is potential for improvement here, so a Lasso model is run.</p>
<h3 id="Lasso-Regression">Lasso Regression<a class="anchor-link" href="#Lasso-Regression">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[103]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>

<span class="c1"># Specify steps of pipeline</span>
<span class="n">r_steps</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;impute&#39;</span><span class="p">,</span> <span class="n">KNNImputer</span><span class="p">()),</span>
           <span class="p">(</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">))]</span>
<span class="c1"># Construct the pipeline</span>
<span class="n">r_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">r_steps</span><span class="p">)</span>
<span class="c1"># Decide ranges of parameters to use</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;impute__n_neighbors&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;lasso__alpha&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1"># Set up cross-validation of the pipeline</span>
<span class="n">lasso_cv</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">r_pipe</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">271</span><span class="p">)</span>
<span class="c1"># Fit Search object to the training data</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">lasso_cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xr_train_trans</span><span class="p">,</span> <span class="n">yr_train</span><span class="p">)</span>

<span class="c1"># Use model to predict on the test set</span>
<span class="n">yr_pred</span> <span class="o">=</span> <span class="n">lasso_cv</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xr_test_trans</span><span class="p">)</span>
<span class="c1"># Show statistics of modelling</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R-squared score of ridge regression: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lasso_cv</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xr_test_trans</span><span class="p">,</span><span class="n">yr_test</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE of ridge regression: </span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">yr_test</span><span class="p">,</span><span class="n">yr_pred</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ridge regression best hyperparameters: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lasso_cv</span><span class="o">.</span><span class="n">best_params_</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>R-squared score of ridge regression: 0.64
MSE of ridge regression: 366
Ridge regression best hyperparameters: {&#39;lasso__alpha&#39;: 1e-05, &#39;impute__n_neighbors&#39;: 7}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lasso gave the same R-squared and MSE as Ridge regression, whilst pushing alpha even lower. This indicates that the models are tending towards less regularisation and a more standard linear model.
As we want to examine the coefficients separately, we look to the Ridge regression to discover which features were most important contributors to failure rates.</p>
<h3 id="Key-Feature-Identification">Key Feature Identification<a class="anchor-link" href="#Key-Feature-Identification">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[105]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The optimal Ridge model is run</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">Xr_train_imp</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">Xr_train_trans</span><span class="p">)</span>
<span class="n">Xr_train_cols</span> <span class="o">=</span> <span class="n">Xr_train</span><span class="o">.</span><span class="n">columns</span>

<span class="n">ridge_best</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">normalize</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ridge_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xr_train_imp</span><span class="p">,</span> <span class="n">yr_train</span><span class="p">)</span>

<span class="c1"># The coefficients of each feature indicate their relative importance to withdrawal rates</span>
<span class="n">coef_list</span><span class="o">=</span><span class="n">ridge_best</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Features&#39;</span><span class="p">:</span><span class="n">Xr_train_cols</span><span class="p">,</span> <span class="s1">&#39;Coefficients&#39;</span><span class="p">:</span><span class="n">coef_list</span><span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Abs_Coefficients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Coefficients&#39;</span><span class="p">])</span>
<span class="c1"># Remove less important features</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Abs_Coefficients&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;posneg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Coefficients&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Abs_Coefficients&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Features&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Abs_Coefficients&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;posneg&#39;</span><span class="p">],</span> <span class="n">rot</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Features&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ridge Coefficient Absolute Value&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Chart showing the most important features affecting average coursework scores&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">leg_neg</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reduced Average Score&#39;</span><span class="p">)</span>
<span class="n">leg_pos</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Increased Average Score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">leg_pos</span><span class="p">,</span> <span class="n">leg_neg</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="output_140_0.png"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Outcomes">Outcomes<a class="anchor-link" href="#Outcomes">&#182;</a></h3><p>The graph shows the factors most important in determining a student's average score. This directly relates to failure rates, as, by the Open University rules, an average score below 40% is a fail (outside of extenuating circumstances). It can be observed that students that engage more with the VLE during the module, with a higher level of education, from a less deprived background, who submit coursework ahead of deadlines, or who study modules BBB/EEE/DDD are more likely to achieve a higher score, and therefore less likely to fail. Conversely, older students or those on modules GGG or FFF are more likely to fail by virtue of a lower score. This provides the University with clear areas to target additional resources and advice for students. Most specifically, they can investigate why GGG may be marked lower than other modules, encourage students to engage more with the VLE, and provide more support for older students.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion">&#182;</a></h1><p>Overall, several target areas have been identified during this work for The Open University to dedicate more resources and support. The primary indicator of students failing or withdrawing is the amount of engagement with the VLE during the course, with more use leading to reduced dropouts and failures. Students with lower coursework scores, females, and those studying more credits are more likely to withdraw, so the university can target these groups with more support as appropriate. Additionally, those with lower existing education levels, who are older or from more deprived backgrounds are more likely to fail. This is important to again dedicate more resources to these groups, as reduced failure rates will likely mean future additional study and more business for the university.</p>
<h2 id="Limitations">Limitations<a class="anchor-link" href="#Limitations">&#182;</a></h2><p>The models developed can be used directly on future groups of students to predict their withdrawal and failure rates. However, there are some limitations to the modelling performed. The test data was split from the main dataset at random, and both sets were transformed independently. This was fine in this scenario as there was a large dataset involved, and the test set was randomly sampled. However, running the same processes here on a new sample of students, particularly if a small sample is used, would potentially create a noticeably different transform function on the sample. To avoid this, the transform function from the PowerTransform step should be hard-coded into the process for future use to ensure best predictions.</p>
<p>Another issue is around limits used on module length. The EDA showed a clear grouping of modules into two categories. A cutoff was decided at 250 days as this was roughly the midpoint between these groups. However, modules of different lengths outside of this dataset could affect this grouping, and could feasibly straddle this somewhat arbitrary cutoff point. If this does happen, then it may make sense in future iterations of these models to keep module length as continuous data.</p>
<p>The n-neighbors was imputed in each model, with no consensus on the 'right' value for this, suggesting this hyperparameter may be artificially boosting the scores of the models. Also, for the classifier process, SMOTE was used to generate a larger sample of the positive class ('Withdraw'). This could be an issue, particularly if the students that withdrew in our sample were not typical of this class, i.e. not representative of students who withdraw generally. In this way, through oversampling, a small bias in the data may have been amplified, making it difficult to generalise this model. Ultimately, we do not know how this data was collected and whether we are using a fair sample that can be generalised. Not only that, but the data is 7 years old, so may not still be relevant to use on future modules and students.</p>
<p>Additionally, some features of the data may have been overlooked or masked in the feature engineering that was used. For example, the vle.csv dataset was not used at all, but may have held useful information. Also, missing values may have been imputed incorrectly, and some records were removed for containing unusual-looking data, but this may have been informative. Not only this, but during EDA it was noticed that there were some students with av_score &lt;40% who still passed - this was assumed to be due to exceptional circumstances, but could mean poor quality data or misinterpretation of these instances.</p>
<h2 id="Further-analysis">Further analysis<a class="anchor-link" href="#Further-analysis">&#182;</a></h2><p>Further analysis could look at alternative models, such as support vector machine or neural networks, to try to improve to outcomes of the test data. It would be useful to also use more data in the analysis to improve the reliability of any conclusions drawn, particularly if the data was more up to date. In this assignment, the primarily important feature in both classification and regression tasks was related to the student's use of the VLE. This was a 10million+ row dataset, from which ultimately only 2 variables were engineered - this data could be further explored to generate more variables to provide a better understanding of how a student's use of the VLE influenced scores/failures and withdrawals.</p>
<p>Ultimately, the models are only as good as the data and processes utilised. As everyone's approach is different and these models are unique to myself, it may be beneficial for the university to use several models from different data scientists from which to draw conclusions.</p>

</div>
</div>
</div>
    </div>
  </div>
</body>
